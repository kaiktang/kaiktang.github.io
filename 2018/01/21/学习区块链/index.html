<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="区块链,比特币," />










<meta name="description" content="比特币基本概念区块链的一个典型应用就是比特币。本质是一个数字资产的公开分布式账本的P2P网络。该账本的正确性和安全性由矿工组成的子网保证，并由矿工审核和记录所有的交易，以获取比特币作为奖励。 参考博文 揭秘比特币和区块链（一）：什么是区块链？ 揭秘比特币和区块链（二）：什么是工作量证明？ 揭秘比特币和区块链（三）：比特币的私钥、公钥与地址 揭秘比特币和区块链（四）：比特币的交易 揭秘比特币和区块链">
<meta name="keywords" content="区块链,比特币">
<meta property="og:type" content="article">
<meta property="og:title" content="学习比特币">
<meta property="og:url" content="http://yoursite.com/2018/01/21/学习区块链/index.html">
<meta property="og:site_name" content="TomKK&#39;s blogs">
<meta property="og:description" content="比特币基本概念区块链的一个典型应用就是比特币。本质是一个数字资产的公开分布式账本的P2P网络。该账本的正确性和安全性由矿工组成的子网保证，并由矿工审核和记录所有的交易，以获取比特币作为奖励。 参考博文 揭秘比特币和区块链（一）：什么是区块链？ 揭秘比特币和区块链（二）：什么是工作量证明？ 揭秘比特币和区块链（三）：比特币的私钥、公钥与地址 揭秘比特币和区块链（四）：比特币的交易 揭秘比特币和区块链">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-7676302038a33c5527b88961eec0673d_hd.jpg">
<meta property="og:image" content="http://p0tsgngca.bkt.clouddn.com/2018-01-23_21-35-53.png">
<meta property="og:image" content="http://p0tsgngca.bkt.clouddn.com/2018-01-24_21-48-29.png">
<meta property="og:image" content="http://p0tsgngca.bkt.clouddn.com/2018-01-25_21-22-47.png">
<meta property="og:image" content="http://p0tsgngca.bkt.clouddn.com/2018-01-25_11-59-02.png">
<meta property="og:image" content="http://p0tsgngca.bkt.clouddn.com/2018-01-25_12-02-14.png">
<meta property="og:updated_time" content="2018-02-07T12:32:28.007Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="学习比特币">
<meta name="twitter:description" content="比特币基本概念区块链的一个典型应用就是比特币。本质是一个数字资产的公开分布式账本的P2P网络。该账本的正确性和安全性由矿工组成的子网保证，并由矿工审核和记录所有的交易，以获取比特币作为奖励。 参考博文 揭秘比特币和区块链（一）：什么是区块链？ 揭秘比特币和区块链（二）：什么是工作量证明？ 揭秘比特币和区块链（三）：比特币的私钥、公钥与地址 揭秘比特币和区块链（四）：比特币的交易 揭秘比特币和区块链">
<meta name="twitter:image" content="https://pic1.zhimg.com/80/v2-7676302038a33c5527b88961eec0673d_hd.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'FBQ33HXA0Q',
      apiKey: '5a256d1a0d5075a6a17b29fbae8cdbdc',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"搜索文章","hits_empty":"没有找到关于: ${query}","hits_stats":"共 ${hits} 条结果耗时 ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/01/21/学习区块链/"/>





  <title>学习比特币 | TomKK's blogs</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8714a47efb513991b4862eafeadb6a3d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">TomKK's blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/21/学习区块链/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="TomKK">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TomKK's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">学习比特币</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-21T11:28:12+08:00">
                2018-01-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/21/学习区块链/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/21/学习区块链/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/01/21/学习区块链/" class="leancloud_visitors" data-flag-title="学习比特币">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="比特币基本概念"><a href="#比特币基本概念" class="headerlink" title="比特币基本概念"></a>比特币基本概念</h1><p>区块链的一个典型应用就是比特币。本质是一个数字资产的公开分布式账本的P2P网络。该账本的正确性和安全性由矿工组成的子网保证，并由矿工审核和记录所有的交易，以获取比特币作为奖励。</p>
<h2 id="参考博文"><a href="#参考博文" class="headerlink" title="参考博文"></a>参考博文</h2><blockquote>
<p><a href="http://www.infoq.com/cn/articles/bitcoin-and-block-chain-part01" target="_blank" rel="noopener">揭秘比特币和区块链（一）：什么是区块链？</a></p>
<p><a href="http://www.infoq.com/cn/articles/bitcoin-and-block-chain-part02" target="_blank" rel="noopener">揭秘比特币和区块链（二）：什么是工作量证明？</a></p>
<p><a href="http://www.infoq.com/cn/articles/bitcoin-and-block-chain-part03" target="_blank" rel="noopener">揭秘比特币和区块链（三）：比特币的私钥、公钥与地址</a></p>
<p><a href="http://www.infoq.com/cn/articles/bitcoin-and-block-chain-part04" target="_blank" rel="noopener">揭秘比特币和区块链（四）：比特币的交易</a></p>
<p><a href="http://www.360doc.com/content/17/0518/20/30659864_655093247.shtml" target="_blank" rel="noopener">揭秘比特币和区块链（五）：深入理解比特币交易的脚本</a></p>
</blockquote>
<h2 id="PoW-Proof-of-Work"><a href="#PoW-Proof-of-Work" class="headerlink" title="PoW(Proof of Work)"></a>PoW(Proof of Work)</h2><p>PoW也被称为挖矿，例如BItcoin中不断尝试哈希值的过程，实际是花费较昂的计算资源。</p>
<p>在产生下一个区块的过程中，奖励总数给第一个解决数学难题的矿工。</p>
<p>矿工为了解决数学难题，不断改进矿机，增大算力，提高称为第一个找到下一个区块者的概率。</p>
<p>这种方式<strong>很浪费资源，因为大家希望得到奖励，所以不会捣乱。</strong></p>
<h2 id="PoS-Proof-of-Stake"><a href="#PoS-Proof-of-Stake" class="headerlink" title="PoS(Proof of Stake)"></a>PoS(Proof of Stake)</h2><p>在PoS模式中，根据代币的持有数量，产生下一个区块的创建者具有某种程度的确定性。</p>
<p>PoS系统并没有区块奖励。因此矿工只拿到交易费。</p>
<p>PoS模式的代币产生基本不需要消耗算力，效率比PoW高得多。</p>
<p>这种方式下，<strong>持有代币最多的那个人，定期会获得利息，为了保护自己的财产，所以也不会捣乱。</strong></p>
<h2 id="钱包地址"><a href="#钱包地址" class="headerlink" title="钱包地址"></a>钱包地址</h2><p>钱包地址应该是该用户公钥的一个<code>hash</code>，为什么不直接用公钥呢，是因为它太长了，存放在区块（1M）中影响交易量。</p>
<p>每个人可以有多个钱包，因为只要有一个私钥就能够导出一个公钥来，所以追踪一个财产是比较困难的，需要知道他所有的钱包地址。</p>
<h2 id="交易UTXO"><a href="#交易UTXO" class="headerlink" title="交易UTXO"></a>交易UTXO</h2><p>交易包含以下三项</p>
<ul>
<li>交易的输入（UTXO指针）</li>
<li>交易的输出（UTXO）</li>
<li>解锁脚本（私钥签名、公钥）</li>
</ul>
<p>UTXO（Unspent Transaction Output）代表了一个未被消费的交易输出。比如：</p>
<blockquote>
<p>A通过挖矿得到了12.5个比特币，UTXO池（数据库）中会记录着A得到的这12.5个比特币的UTXO，记为UTXO1。然后A将转账给B和C各5个比特币，并转给自己2.5个比特币。这里有几点需要说明，首先当A的这个转账的交易发出后，数据库中UTXO1将被删除，继而产生新的记录分别记为，UTXO2（对应转给B的5个比特币），UTXO3（对应转给C的5个比特币），UTXO4（对应转给A的2.5个比特币）。这里为什么需要转给A自己2.5个比特币呢，那是因为如果这次交易中这UTXO1所代表的12.5个比特币最终都会被花掉（因为UTXO1作废了），如果不把余额转给自己，那么这将作为打包区块的矿工的小费进入他名下。而矿工会优先确认小费高的那个区块交易。</p>
</blockquote>
<p>一个用户的余额是根据众多的他的UTXO计算出来的。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>每个区块中的记录第一个交易是<code>coinbase</code>即代表刚从“矿山”里挖出来的“金矿”，其实就是奖励给第一个算出合格哈希的矿工的比特币，每笔交易中流转的比特币最终都能回溯到，它被挖出来的那次<code>coinbase</code>，所以比特币难以造假。</p>
<p>经过6个以上区块确认的交易才是安全确认的。</p>
<blockquote>
<p>举个例子，有一些挖矿者先收到block A，另一些挖矿者先收到的是block B。那些收到block A的挖矿者将要继续沿着他们的分支挖矿，而其他人沿着Block B的分支挖矿（目前来看同一份钱被花了两次）。我们假设在B分支上的挖矿者先成功挖到下一个block，当他们收到这个消息后，在A分支的人会注意到现在B分支是最长的，于是就会转换到B的分支。在A分支上的工作就会迅速的停止，这样每个人就会都在同一个顺序的blockchain上工作了。所有在block A里面的待定交易将会继续保持待定状态，随后会在B分支上被放到新的block里，这样，所有的交易最终还是会被验证的。</p>
</blockquote>
<p><del>假设交易中，买家给了卖家比特币来购买商品，但是使用的确是分叉链中产生的UTXO，如果卖家心比较大，直接发货了，之后如果原来那条分叉链被抛弃，那么整条链条中基于被抛弃分叉链所产生的UTXO都将失效的，即卖家收到的钱又回到了买家手里。</del></p>
<p><del>这么理解应该是错的，因为UTXO是一个数据结构，即使在分叉链中产生的UTXO应该都是一样的。</del></p>
<p><img src="https://pic1.zhimg.com/80/v2-7676302038a33c5527b88961eec0673d_hd.jpg" alt="UTXO数据结构"></p>
<p><del>卖家真正担心不应该是诚实节点造成的分叉，而应该是恶意节点来篡改记录。</del>那么恶意节点可能如何来篡改呢？</p>
<blockquote>
<p>比如一个恶意的买家，先向卖家付了钱，卖家在交易被确认一次后就马上把货物给了买家。买家在收到货物后想要把刚花出去的这笔钱再花一遍，听起来好像很不可能但是这确实是有可能的。只要这个买家掌握了大量的算力，以更快的速度去确认交易，让包含自己第二次交易的链的长度超过第一次交易（用的同一笔钱）所在链的长度，那么根据约定第二次交易将会被网络采纳，即卖家得到的钱将无效，即他的那条UTXO将不被其他节点承认。这个双花犯罪的关键在于追赶的速度（之所以一定为追赶，因为必定要先付款给卖家再作假赶超）。要避免这个双花的问题的话，就让卖家默认等到确认6次以后再发货，这时恶意买家已经落后6个区块了（比之前假设的确认1一次就发货的难度大得多），想要追赶在理论上是不可行的，或者说不划算的，这样这笔钱才能说真正的到了卖家口袋里。</p>
</blockquote>
<p>最终结论，两种担心都是存在的。之前那种<code>所有的交易在链1和链2里面都存在，所以对于用户而言UTXO列表都是一样的</code>，这个前提中，是可能存在某个交易在链1里面出现了，但是在链2里面没有出现的情况。因为不同矿工打包的规则是不同的，在同一个交易列表中，不同矿工可能选择不同的交易来打包，而谁算的最快那就用谁选的交易来打包。所以在临时分叉的情况下，可能存在这种情况</p>
<blockquote>
<p>某个交易发出后，被采用链1（临时状态）的节点打包进了链条，但是却没有被链2所打包确认，这时这笔交易目前还不是安全的，因为如果这时链1被抛弃，那么这笔交易将依旧没被确认。</p>
</blockquote>
<h2 id="拜占庭将军问题（Byzantine-Generals-Problem）"><a href="#拜占庭将军问题（Byzantine-Generals-Problem）" class="headerlink" title="拜占庭将军问题（Byzantine Generals Problem）"></a>拜占庭将军问题（Byzantine Generals Problem）</h2><blockquote>
<p><strong>结论：</strong>若叛徒数为m，当且仅当将军总数n&gt;=3m+1时才有解</p>
</blockquote>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><ul>
<li>拜占庭帝国派出10只军队，去包围进攻一个强大的敌人</li>
<li>至少6只军队同时进攻才能攻下敌国</li>
</ul>
<h3 id="难题"><a href="#难题" class="headerlink" title="难题"></a>难题</h3><p>一些将军可能是叛徒，会发布假的（相反的）进攻意向</p>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>将军们需要找到一种共识机制（即要么全部进攻，要不全部不进攻，免得打败仗，这里容易误解为一定要达成进攻意见），可以远程协商，赢取战斗</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul>
<li>每个节点给所有的其它节点发送消息</li>
<li>每个节点根据接收到的所有消息来决定最终的策略</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>每个节点需要向全网节点发送大量消息，可能造成网络延时</p>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>假设这里叛将只有一个，忠将有3个。A是总将军。信号0代表不进攻，信号1代表进攻。</p>
<p><strong>情况一：</strong>叛徒为B，忠臣为A，C，D</p>
<p>A(忠)发起进攻提议，即 A发给B，C，D信号1</p>
<p>B收到后，捣乱，发给A，C，D信号0，企图让部分将军不出兵，导致战斗失利</p>
<p>C收到后，向A，B，D如实发送信号1，代表自己收到的命令是1</p>
<p>D同理</p>
<p>最终</p>
<table>
<thead>
<tr>
<th style="text-align:center">临近将军节点</th>
<th style="text-align:center">B收到的信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">C</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p>对于B，因为是叛徒，则其肯定不会发起进攻，即使收到了三个1</p>
<table>
<thead>
<tr>
<th style="text-align:center">临近将军节点</th>
<th style="text-align:center">C收到的信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">B</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p>对于C进攻2票，故选择进攻。</p>
<p>A，D同理。最终会有半数以上（3位）的将军发起进攻。</p>
<p><strong>情况二：</strong>总将军A为叛徒，B，C，D为忠臣。A试图让军队少于半数选择进攻。</p>
<p>A(叛)向B发出进攻信号1，向C和D发出信号0</p>
<p>B收到后，发给A，C，D信号1</p>
<p>C收到后，向A，B，D如实发送信号0，代表自己收到的命令是0</p>
<p>D同理</p>
<p>最终</p>
<table>
<thead>
<tr>
<th style="text-align:center">临近将军节点</th>
<th style="text-align:center">B收到的信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">C</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">临近将军节点</th>
<th style="text-align:center">C收到的信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">B</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">临近将军节点</th>
<th style="text-align:center">D收到的信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">C</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">B</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p>最终没有一个将军会发起进攻，叛徒依旧没有得逞。</p>
<h2 id="密码学基础"><a href="#密码学基础" class="headerlink" title="密码学基础"></a>密码学基础</h2><h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>公钥用于加密，私钥用于解密</p>
<p>公钥可以通过私钥生成，私钥可以推导出公钥</p>
<p>从公钥无法推导出私钥</p>
<p>相同输入每次加密得到的结果不同</p>
<p><strong>优点：</strong>解决了密钥传输过程中的安全性问题</p>
<p><strong>不足：</strong>虽然解决了信息安全传输不被窃听的问题，但是无法验证“该消息确实是发送方发送的”，有可能是中间人截获了信息然后篡改了内容，再发送的（只需要获取接受者公钥即可）。</p>
<h3 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a>哈希</h3><p>对于存放用户密码的场景，简单的hash可能会收到彩虹表攻击（就是预先计算好一些列的哈希值，然后进行对比），而此时可以通过加盐来加大破解的成本。</p>
<h3 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h3><p><img src="http://p0tsgngca.bkt.clouddn.com/2018-01-23_21-35-53.png" alt="数字签名示意图"></p>
<p>通过数字签名中的私钥加密摘要的过程，可以保证接受者可以判断消息是否来自发送方，且没有被篡改过。</p>
<h3 id="证书授权中心CA（Certificate-Authority）"><a href="#证书授权中心CA（Certificate-Authority）" class="headerlink" title="证书授权中心CA（Certificate Authority）"></a>证书授权中心CA（Certificate Authority）</h3><p><strong>为了解决这样一种情况：</strong>在获取公钥的过程中，被攻击者截获，然后把他的公钥发给了接受者，那么接受者将会把消息发给攻击者了。</p>
<ul>
<li>CA解决了电子商务中公钥的可信度问题</li>
<li>负责证明“我确实是我”的问题</li>
<li>CA是受信任的第三方，公钥的合法性检验</li>
<li>CA证书的内容<ul>
<li>证书持有人的公钥</li>
<li>证书授权中心名称</li>
<li>证书有效期</li>
<li>证书授权中心的数字签名</li>
</ul>
</li>
</ul>
<p>前提是大家都信任这个CA（第三方的公司），大家都事先有CA的公钥。发送者将自己的公钥存放在CA里，CA用他的私钥进行签名，然后发送者将这个CA发给接受者，接受者通过CA的公钥去查看证书内的内容，即可取出发送者的公钥，以及其中的实体名称。因为CA是通过私钥签名的所以这个实体和公钥的绑定关系，所以无法伪造。</p>
<p><strong>CA证书使用场景-HTTPS</strong></p>
<ul>
<li>客户端通过https向服务器发送安全连接请求</li>
<li>服务器用私钥加密网页内容，连同CA证书一并发给客户端</li>
<li>客户端会根据CA证书验证CA是否合法<ul>
<li>如果验证失败，客户端弹出警告信息</li>
<li>如果验证通过，客户端使用CA证书中的公钥向服务器发送加密信息</li>
</ul>
</li>
<li>像Chrome访问https报红，是因为在Chrome里面预先存储了一些CA，然后获取到的新CA不在这个列表里面，所以会警告，只要把这个新的CA导入到浏览器里面就不会再警告了。</li>
</ul>
<h2 id="未花费交易输出UTXO-Unspent-TranXtion-Output"><a href="#未花费交易输出UTXO-Unspent-TranXtion-Output" class="headerlink" title="未花费交易输出UTXO-Unspent TranXtion Output"></a>未花费交易输出UTXO-Unspent TranXtion Output</h2><ul>
<li>UTXO，用比特币拥有者的公钥锁定（加密）的一个数字</li>
<li>UTXO == 比特币</li>
<li>比特币系统里没有比特币，只有UTXO</li>
<li>比特币系统里没有账户，只有UTXO（公钥锁定）</li>
<li>比特币系统里没有余额，只有UTXO（账户余额只是比特币钱包的概念）</li>
<li>UTXO存在全节点的数据库里</li>
<li>转账将消耗属于你自己的UTXO，同时生成新的UTXO，并用接受者的公钥锁定。</li>
</ul>
<h2 id="交易验证-基于栈的脚本语言"><a href="#交易验证-基于栈的脚本语言" class="headerlink" title="交易验证-基于栈的脚本语言"></a>交易验证-基于栈的脚本语言</h2><ul>
<li><p>栈（stack</p>
</li>
<li><p>交易验证</p>
<ul>
<li>对栈的操作：OP_DUP（复制粘贴栈顶元素），碰到数字就压栈</li>
<li>逻辑运算符：OP_EQUALVERIFY（比较栈顶的两个元素是否相等，如果不等，整个脚本就执行失败了，如果相等，脚本会继续执行）</li>
<li>加解密运算符：OP_HASH160（对栈顶元素计算SHA256/RipeMD160），OP_CHECKSIG（验证签名）</li>
<li>算数运算符：OP_ADD，OP_SUB，OP_MUL，OP_DIV</li>
</ul>
</li>
<li><p>锁定脚本</p>
<ul>
<li>OP_DUP OP_HASH160 &lt;<strong>发送者</strong>公钥哈希&gt; OP_EQUALVERIFY OP_CHECKSIG</li>
<li>在锁定的时候的接受者，即为解锁消费时候的发送者，这里是站在解锁消费的角度上来看</li>
</ul>
</li>
<li><p>解锁脚本</p>
<ul>
<li>&lt;发送者签名&gt; &lt;发送者公钥&gt;（提供自己的签名和公钥来证明我确实是我）</li>
</ul>
</li>
<li><p>交易验证：<strong>运行解锁脚本 + 锁定脚本</strong> =&gt; True</p>
</li>
<li><p><a href="https://pic1.zhimg.com/80/v2-7676302038a33c5527b88961eec0673d_hd.jpg" target="_blank" rel="noopener">揭秘比特币和区块链（五）：深入理解比特币交易的脚本</a></p>
<blockquote>
<p>疑问：验证发送者公钥哈希是否多余？</p>
<p>答：不是的，因为如果没有这一步，任何人只要根据自己的私钥生成一个签名和公钥都可以通过验证。通过验证公钥哈希，首先可以确定目前的发送者的公钥和当初UTXO生成时指定的接收者的公钥是相同的。然后再来判断你是否还能提供跟进一步的签名。</p>
</blockquote>
</li>
</ul>
<h2 id="交易的传播"><a href="#交易的传播" class="headerlink" title="交易的传播"></a>交易的传播</h2><ul>
<li>交易包含两部分，n输入和m输出，n&gt;=0，m&gt;0<ul>
<li>输入 == 要被花费的UTXO + 解锁脚本</li>
<li>输出 == UTXO（币值 + 锁定脚本）</li>
</ul>
</li>
<li>钱包软件生成交易，并向邻近节点传播</li>
<li>节点对收到的交易进行验证，并丢弃不合法交易<ul>
<li>交易的size要小于区块size的上限</li>
<li>交易输入UTXO是存在的</li>
<li>交易输入UTXO没有被其他交易引用-防止双花（Double Spending）</li>
<li>输入总金额 &gt; 输出总金额</li>
<li>解锁脚本验证</li>
</ul>
</li>
<li>将合格的交易加入到本地的Transaction数据库中，并将合法交易转给邻近节点</li>
</ul>
<h2 id="区块的生成"><a href="#区块的生成" class="headerlink" title="区块的生成"></a>区块的生成</h2><ul>
<li><p>矿工在挖块前要组建区块</p>
<ul>
<li><p>将<code>coinbase</code>交易打包进区块</p>
</li>
<li><p>将交易池中高优先级的交易打包进区块</p>
<ul>
<li>优先级 = 交易的额度 * UTXO的深度 / 交易的size</li>
<li>在优先级中加入UTXO的深度可以防止连续的交易（大额来回转账）造成的粉尘攻击</li>
</ul>
</li>
<li><p>创建区块的头部</p>
<p>| 版本号  | 前一个区块的哈希 | Merkel树根 | 时间戳  | 难度值  | Nonce |<br>| :–: | :——: | :——: | :–: | :–: | :—: |<br>|      |          |          |      |      |       |</p>
</li>
<li><p>挖矿成功后，将计算出来的随机数<code>nonce</code>填入区块头部，向邻近节点传播</p>
</li>
</ul>
</li>
</ul>
<h2 id="区块的验证链接"><a href="#区块的验证链接" class="headerlink" title="区块的验证链接"></a>区块的验证链接</h2><ul>
<li>相邻节点收到新区块后，立即做一下检查<ul>
<li>验证POW的nonce值是否符合难度值</li>
<li>检查时间戳是否小于当前时间2小时</li>
<li>检查Merkle树根是否正确</li>
<li>检查区块size要小于区块size的上限</li>
<li>第一笔交易必须是<code>coinbase</code></li>
<li>验证每个交易</li>
</ul>
</li>
</ul>
<h2 id="Merkle-Tree结构"><a href="#Merkle-Tree结构" class="headerlink" title="Merkle Tree结构"></a>Merkle Tree结构</h2><p><img src="http://p0tsgngca.bkt.clouddn.com/2018-01-24_21-48-29.png" alt="Merkle Tree"></p>
<ul>
<li>特点<ul>
<li>全二叉树（如果叶子节点为单数则复制最后一个交易）</li>
</ul>
</li>
<li>作用<ul>
<li>防止数据篡改（叶子节点的改变会影响到根 ）</li>
<li>快速验证某个交易是否存在</li>
<li>节点存储Hash值</li>
<li>从叶子节点构造树</li>
</ul>
</li>
</ul>
<h2 id="钱包地址的生成"><a href="#钱包地址的生成" class="headerlink" title="钱包地址的生成"></a>钱包地址的生成</h2><p><img src="http://p0tsgngca.bkt.clouddn.com/2018-01-25_21-22-47.png" alt="钱包地址的生成"></p>
<h1 id="区块链分叉"><a href="#区块链分叉" class="headerlink" title="区块链分叉"></a>区块链分叉</h1><h2 id="软分叉"><a href="#软分叉" class="headerlink" title="软分叉"></a>软分叉</h2><p><img src="http://p0tsgngca.bkt.clouddn.com/2018-01-25_11-59-02.png" alt="软分叉"></p>
<ul>
<li>由比特币交易的数据结构改变引起，但区块的数据结构未改变</li>
<li>老节点接收新旧格式的区块，新节点只接受新区块<ul>
<li>矿工激活软分叉<code>MASF-Miner Acivated Soft Fork</code></li>
<li>用户激活软分叉<code>UASF-User Activated Soft Fork</code><ul>
<li>Core团队新发明，应对矿工的不合作</li>
<li>隔离见证<code>Segwit-Segregation Witness</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="硬分叉"><a href="#硬分叉" class="headerlink" title="硬分叉"></a>硬分叉</h2><p><img src="http://p0tsgngca.bkt.clouddn.com/2018-01-25_12-02-14.png" alt="硬分叉"></p>
<ul>
<li>由于交易结构的变化，或区块的结构的变化引起的</li>
<li>新旧节点相互拒绝对方的区块</li>
<li>产生两个币种，如BCC</li>
</ul>
<h2 id="临时分叉"><a href="#临时分叉" class="headerlink" title="临时分叉"></a>临时分叉</h2><ul>
<li>仅发生于几乎同时爆块的情况</li>
<li>分叉是暂时的</li>
<li>根据公示机制，矿工最终切换到最长链上挖矿</li>
<li>短链上的交易全部无效，包括矿工费</li>
</ul>
<h2 id="隔离见证"><a href="#隔离见证" class="headerlink" title="隔离见证"></a>隔离见证</h2><ul>
<li>隔离见证<ul>
<li>安全隐患、黑客通过改变交易签名信息改变交易ID</li>
<li>将签名部分从交易中移除，从而间接扩容</li>
</ul>
</li>
<li>香港共识</li>
<li>纽约共识</li>
</ul>
<h2 id="比特币私钥格式WIF-Wallet-Import-Format"><a href="#比特币私钥格式WIF-Wallet-Import-Format" class="headerlink" title="比特币私钥格式WIF-Wallet Import Format"></a>比特币私钥格式WIF-Wallet Import Format</h2><ul>
<li>WIF私钥格式更短，标准格式私钥256个bit，16进制长度 = 256 / 4 = 64字符<ul>
<li>经过Base65编码，表示长度更短</li>
<li>未压缩格式私钥：5开头，大小为<strong>51</strong>字节，第一位存放版本信息</li>
<li>压缩格式私钥（指生成压缩格式公钥的私钥）：K或L开头，大小为52字节，第一位放版本信息，多出的最后一个字节存放是否压缩信息</li>
</ul>
</li>
<li>WIF格式可以自动侦测地址错误（方便钱包筛选）<ul>
<li>通过私钥的哈希值产生校验码</li>
</ul>
</li>
</ul>
<h2 id="公钥-压缩格式-amp-非压缩格式"><a href="#公钥-压缩格式-amp-非压缩格式" class="headerlink" title="公钥-压缩格式&amp;非压缩格式"></a>公钥-压缩格式&amp;非压缩格式</h2><ul>
<li>公钥由X和Y轴的值组成</li>
<li>未压缩的公钥以<code>04</code>开头</li>
<li>压缩公钥以<code>02/03</code>开头</li>
</ul>
<h2 id="轻钱包-amp-SPV验证机制"><a href="#轻钱包-amp-SPV验证机制" class="headerlink" title="轻钱包&amp;SPV验证机制"></a>轻钱包&amp;SPV验证机制</h2><ul>
<li><p>轻钱包是比特币的非全节点，存储空间限制</p>
<ul>
<li><p>只下载<code>block header</code>，size很小只有80字节，区块本身大小1M，1.8M</p>
<p>| 版本号  | 前区块哈希 | Merkle树根 | 时间戳  | 难度值  | Nonce |<br>| :–: | :—: | :——: | :–: | :–: | :—: |<br>|      |       |          |      |      |       |</p>
</li>
<li><p>向邻近全节点发送请求得到UTXO信息</p>
</li>
</ul>
</li>
<li><p>简单支付验证SPV - <code>Simplified Payment Verification</code></p>
<ul>
<li>非全节点支付验证，判断交易是否已经在区块链中，多少确认数</li>
<li>向邻近全节点发送请求关于特定比特币地址和交易的信息</li>
<li>邻近全节点向钱包返回<code>Mekle Path</code>验证路径和相应的<code>block header</code></li>
<li>钱包根据<code>Merkle Path</code>计算出<code>Mekle Root</code>，验证是否匹配<code>Block header</code>里的<code>Merkle Root</code>值</li>
<li>确认响应的<code>Block header</code>的深度是否大于6</li>
</ul>
</li>
</ul>
<h2 id="私钥的生成建议"><a href="#私钥的生成建议" class="headerlink" title="私钥的生成建议"></a>私钥的生成建议</h2><p>可以选用一串中文<code>C</code>和一串英文<code>E</code>，分别利用MD5进行hash，得到两个128bit的哈希字符串<code>H(C)</code>和<code>H(E)</code>，然后首尾相连（正好256bit）<code>H(C)+H(E)</code>，再将最后的 8位替换成某人的生日</p>
<h2 id="挖矿"><a href="#挖矿" class="headerlink" title="挖矿"></a>挖矿</h2><p><a href="http://www.infoq.com/cn/articles/bitcoin-and-block-chain-part02" target="_blank" rel="noopener">揭秘比特币和区块链（二）：什么是工作量证明？</a></p>
<p><strong>区块头部</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">版本号</th>
<th style="text-align:center">前区块哈希</th>
<th style="text-align:center">Merkle树根</th>
<th style="text-align:center">时间戳</th>
<th style="text-align:center">难度值</th>
<th style="text-align:center">Nonce</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">4字节</td>
<td style="text-align:center">32字节</td>
<td style="text-align:center">32字节</td>
<td style="text-align:center">4字节</td>
<td style="text-align:center">4字节</td>
<td style="text-align:center">4字节</td>
</tr>
</tbody>
</table>
<p>为了使区块头部哈希的结果值小于目标值，会不断修改尝试不同的<code>nonce</code>值，但是随着难度值的升高而且<code>nonce</code>值长度的限制，所以很可能遍历完所有的$$2^{32}$$个数都没有成功，这时矿工会调整交易的顺序或者<code>coinbase</code>里的<code>extranonce</code>以此来影响<code>Merkle tree root</code>的哈希值。以此来改变区块头部哈希的值，再来新的一轮尝试。 </p>
<h1 id="区块链安全"><a href="#区块链安全" class="headerlink" title="区块链安全"></a>区块链安全</h1><h2 id="可塑性攻击"><a href="#可塑性攻击" class="headerlink" title="可塑性攻击"></a>可塑性攻击</h2><p>存在多个可被验证的交易签名，这样修改交易签名引起交易的哈希值改变，即TXID改变，而这样会导致原TXID无法找到。</p>
<p><code>隔离见证</code>：</p>
<ul>
<li>将可伪造的签名部分移除交易数据结构，在另一个地方存放签名</li>
<li>改变签名不影响TXID的变化</li>
</ul>
<blockquote>
<p>攻击者先去交易所提币，然后侦听数据包并截获交易所给自己账户转钱的区块数据包，并把其中关于自己的交易的签名修改了，那么会导致生成交易的ID和交易所里面记录的交易ID不同，于是这个被修改的区块就会先被主链所接受而拒绝交易所发出的区块，因为这笔交易已经被记录过了。这时，攻击者会联系交易所说自己并没有收到钱，是交易所的系统故障了要求重发，于是攻击者就获得了两份的比特币。</p>
</blockquote>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/区块链/" rel="tag"># 区块链</a>
          
            <a href="/tags/比特币/" rel="tag"># 比特币</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/11/学习Linux/" rel="next" title="学习Linux">
                <i class="fa fa-chevron-left"></i> 学习Linux
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/02/06/理解以太坊Merkle Patricia Trie/" rel="prev" title="理解以太坊Merkle-patricia-tree">
                理解以太坊Merkle-patricia-tree <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="TomKK" />
            
              <p class="site-author-name" itemprop="name">TomKK</p>
              <p class="site-description motion-element" itemprop="description">学而后知不足</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#比特币基本概念"><span class="nav-number">1.</span> <span class="nav-text"><a href="#&#x6BD4;&#x7279;&#x5E01;&#x57FA;&#x672C;&#x6982;&#x5FF5;" class="headerlink" title="&#x6BD4;&#x7279;&#x5E01;&#x57FA;&#x672C;&#x6982;&#x5FF5;"></a>&#x6BD4;&#x7279;&#x5E01;&#x57FA;&#x672C;&#x6982;&#x5FF5;</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#参考博文"><span class="nav-number">1.1.</span> <span class="nav-text"><a href="#&#x53C2;&#x8003;&#x535A;&#x6587;" class="headerlink" title="&#x53C2;&#x8003;&#x535A;&#x6587;"></a>&#x53C2;&#x8003;&#x535A;&#x6587;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PoW-Proof-of-Work"><span class="nav-number">1.2.</span> <span class="nav-text"><a href="#PoW-Proof-of-Work" class="headerlink" title="PoW(Proof of Work)"></a>PoW(Proof of Work)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PoS-Proof-of-Stake"><span class="nav-number">1.3.</span> <span class="nav-text"><a href="#PoS-Proof-of-Stake" class="headerlink" title="PoS(Proof of Stake)"></a>PoS(Proof of Stake)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#钱包地址"><span class="nav-number">1.4.</span> <span class="nav-text"><a href="#&#x94B1;&#x5305;&#x5730;&#x5740;" class="headerlink" title="&#x94B1;&#x5305;&#x5730;&#x5740;"></a>&#x94B1;&#x5305;&#x5730;&#x5740;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#交易UTXO"><span class="nav-number">1.5.</span> <span class="nav-text"><a href="#&#x4EA4;&#x6613;UTXO" class="headerlink" title="&#x4EA4;&#x6613;UTXO"></a>&#x4EA4;&#x6613;UTXO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">1.6.</span> <span class="nav-text"><a href="#&#x5176;&#x4ED6;" class="headerlink" title="&#x5176;&#x4ED6;"></a>&#x5176;&#x4ED6;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拜占庭将军问题（Byzantine-Generals-Problem）"><span class="nav-number">1.7.</span> <span class="nav-text"><a href="#&#x62DC;&#x5360;&#x5EAD;&#x5C06;&#x519B;&#x95EE;&#x9898;&#xFF08;Byzantine-Generals-Problem&#xFF09;" class="headerlink" title="&#x62DC;&#x5360;&#x5EAD;&#x5C06;&#x519B;&#x95EE;&#x9898;&#xFF08;Byzantine Generals Problem&#xFF09;"></a>&#x62DC;&#x5360;&#x5EAD;&#x5C06;&#x519B;&#x95EE;&#x9898;&#xFF08;Byzantine Generals Problem&#xFF09;</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#背景"><span class="nav-number">1.7.1.</span> <span class="nav-text"><a href="#&#x80CC;&#x666F;" class="headerlink" title="&#x80CC;&#x666F;"></a>&#x80CC;&#x666F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#难题"><span class="nav-number">1.7.2.</span> <span class="nav-text"><a href="#&#x96BE;&#x9898;" class="headerlink" title="&#x96BE;&#x9898;"></a>&#x96BE;&#x9898;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#目的"><span class="nav-number">1.7.3.</span> <span class="nav-text"><a href="#&#x76EE;&#x7684;" class="headerlink" title="&#x76EE;&#x7684;"></a>&#x76EE;&#x7684;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决方案"><span class="nav-number">1.7.4.</span> <span class="nav-text"><a href="#&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="headerlink" title="&#x89E3;&#x51B3;&#x65B9;&#x6848;"></a>&#x89E3;&#x51B3;&#x65B9;&#x6848;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缺点"><span class="nav-number">1.7.5.</span> <span class="nav-text"><a href="#&#x7F3A;&#x70B9;" class="headerlink" title="&#x7F3A;&#x70B9;"></a>&#x7F3A;&#x70B9;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例"><span class="nav-number">1.7.6.</span> <span class="nav-text"><a href="#&#x4E3E;&#x4F8B;" class="headerlink" title="&#x4E3E;&#x4F8B;"></a>&#x4E3E;&#x4F8B;</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#密码学基础"><span class="nav-number">1.8.</span> <span class="nav-text"><a href="#&#x5BC6;&#x7801;&#x5B66;&#x57FA;&#x7840;" class="headerlink" title="&#x5BC6;&#x7801;&#x5B66;&#x57FA;&#x7840;"></a>&#x5BC6;&#x7801;&#x5B66;&#x57FA;&#x7840;</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#非对称加密"><span class="nav-number">1.8.1.</span> <span class="nav-text"><a href="#&#x975E;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;" class="headerlink" title="&#x975E;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;"></a>&#x975E;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#哈希"><span class="nav-number">1.8.2.</span> <span class="nav-text"><a href="#&#x54C8;&#x5E0C;" class="headerlink" title="&#x54C8;&#x5E0C;"></a>&#x54C8;&#x5E0C;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数字签名"><span class="nav-number">1.8.3.</span> <span class="nav-text"><a href="#&#x6570;&#x5B57;&#x7B7E;&#x540D;" class="headerlink" title="&#x6570;&#x5B57;&#x7B7E;&#x540D;"></a>&#x6570;&#x5B57;&#x7B7E;&#x540D;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#证书授权中心CA（Certificate-Authority）"><span class="nav-number">1.8.4.</span> <span class="nav-text"><a href="#&#x8BC1;&#x4E66;&#x6388;&#x6743;&#x4E2D;&#x5FC3;CA&#xFF08;Certificate-Authority&#xFF09;" class="headerlink" title="&#x8BC1;&#x4E66;&#x6388;&#x6743;&#x4E2D;&#x5FC3;CA&#xFF08;Certificate Authority&#xFF09;"></a>&#x8BC1;&#x4E66;&#x6388;&#x6743;&#x4E2D;&#x5FC3;CA&#xFF08;Certificate Authority&#xFF09;</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#未花费交易输出UTXO-Unspent-TranXtion-Output"><span class="nav-number">1.9.</span> <span class="nav-text"><a href="#&#x672A;&#x82B1;&#x8D39;&#x4EA4;&#x6613;&#x8F93;&#x51FA;UTXO-Unspent-TranXtion-Output" class="headerlink" title="&#x672A;&#x82B1;&#x8D39;&#x4EA4;&#x6613;&#x8F93;&#x51FA;UTXO-Unspent TranXtion Output"></a>&#x672A;&#x82B1;&#x8D39;&#x4EA4;&#x6613;&#x8F93;&#x51FA;UTXO-Unspent TranXtion Output</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#交易验证-基于栈的脚本语言"><span class="nav-number">1.10.</span> <span class="nav-text"><a href="#&#x4EA4;&#x6613;&#x9A8C;&#x8BC1;-&#x57FA;&#x4E8E;&#x6808;&#x7684;&#x811A;&#x672C;&#x8BED;&#x8A00;" class="headerlink" title="&#x4EA4;&#x6613;&#x9A8C;&#x8BC1;-&#x57FA;&#x4E8E;&#x6808;&#x7684;&#x811A;&#x672C;&#x8BED;&#x8A00;"></a>&#x4EA4;&#x6613;&#x9A8C;&#x8BC1;-&#x57FA;&#x4E8E;&#x6808;&#x7684;&#x811A;&#x672C;&#x8BED;&#x8A00;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#交易的传播"><span class="nav-number">1.11.</span> <span class="nav-text"><a href="#&#x4EA4;&#x6613;&#x7684;&#x4F20;&#x64AD;" class="headerlink" title="&#x4EA4;&#x6613;&#x7684;&#x4F20;&#x64AD;"></a>&#x4EA4;&#x6613;&#x7684;&#x4F20;&#x64AD;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#区块的生成"><span class="nav-number">1.12.</span> <span class="nav-text"><a href="#&#x533A;&#x5757;&#x7684;&#x751F;&#x6210;" class="headerlink" title="&#x533A;&#x5757;&#x7684;&#x751F;&#x6210;"></a>&#x533A;&#x5757;&#x7684;&#x751F;&#x6210;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#区块的验证链接"><span class="nav-number">1.13.</span> <span class="nav-text"><a href="#&#x533A;&#x5757;&#x7684;&#x9A8C;&#x8BC1;&#x94FE;&#x63A5;" class="headerlink" title="&#x533A;&#x5757;&#x7684;&#x9A8C;&#x8BC1;&#x94FE;&#x63A5;"></a>&#x533A;&#x5757;&#x7684;&#x9A8C;&#x8BC1;&#x94FE;&#x63A5;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Merkle-Tree结构"><span class="nav-number">1.14.</span> <span class="nav-text"><a href="#Merkle-Tree&#x7ED3;&#x6784;" class="headerlink" title="Merkle Tree&#x7ED3;&#x6784;"></a>Merkle Tree&#x7ED3;&#x6784;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#钱包地址的生成"><span class="nav-number">1.15.</span> <span class="nav-text"><a href="#&#x94B1;&#x5305;&#x5730;&#x5740;&#x7684;&#x751F;&#x6210;" class="headerlink" title="&#x94B1;&#x5305;&#x5730;&#x5740;&#x7684;&#x751F;&#x6210;"></a>&#x94B1;&#x5305;&#x5730;&#x5740;&#x7684;&#x751F;&#x6210;</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#区块链分叉"><span class="nav-number">2.</span> <span class="nav-text"><a href="#&#x533A;&#x5757;&#x94FE;&#x5206;&#x53C9;" class="headerlink" title="&#x533A;&#x5757;&#x94FE;&#x5206;&#x53C9;"></a>&#x533A;&#x5757;&#x94FE;&#x5206;&#x53C9;</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#软分叉"><span class="nav-number">2.1.</span> <span class="nav-text"><a href="#&#x8F6F;&#x5206;&#x53C9;" class="headerlink" title="&#x8F6F;&#x5206;&#x53C9;"></a>&#x8F6F;&#x5206;&#x53C9;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#硬分叉"><span class="nav-number">2.2.</span> <span class="nav-text"><a href="#&#x786C;&#x5206;&#x53C9;" class="headerlink" title="&#x786C;&#x5206;&#x53C9;"></a>&#x786C;&#x5206;&#x53C9;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#临时分叉"><span class="nav-number">2.3.</span> <span class="nav-text"><a href="#&#x4E34;&#x65F6;&#x5206;&#x53C9;" class="headerlink" title="&#x4E34;&#x65F6;&#x5206;&#x53C9;"></a>&#x4E34;&#x65F6;&#x5206;&#x53C9;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#隔离见证"><span class="nav-number">2.4.</span> <span class="nav-text"><a href="#&#x9694;&#x79BB;&#x89C1;&#x8BC1;" class="headerlink" title="&#x9694;&#x79BB;&#x89C1;&#x8BC1;"></a>&#x9694;&#x79BB;&#x89C1;&#x8BC1;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#比特币私钥格式WIF-Wallet-Import-Format"><span class="nav-number">2.5.</span> <span class="nav-text"><a href="#&#x6BD4;&#x7279;&#x5E01;&#x79C1;&#x94A5;&#x683C;&#x5F0F;WIF-Wallet-Import-Format" class="headerlink" title="&#x6BD4;&#x7279;&#x5E01;&#x79C1;&#x94A5;&#x683C;&#x5F0F;WIF-Wallet Import Format"></a>&#x6BD4;&#x7279;&#x5E01;&#x79C1;&#x94A5;&#x683C;&#x5F0F;WIF-Wallet Import Format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#公钥-压缩格式-amp-非压缩格式"><span class="nav-number">2.6.</span> <span class="nav-text"><a href="#&#x516C;&#x94A5;-&#x538B;&#x7F29;&#x683C;&#x5F0F;-amp-&#x975E;&#x538B;&#x7F29;&#x683C;&#x5F0F;" class="headerlink" title="&#x516C;&#x94A5;-&#x538B;&#x7F29;&#x683C;&#x5F0F;&amp;&#x975E;&#x538B;&#x7F29;&#x683C;&#x5F0F;"></a>&#x516C;&#x94A5;-&#x538B;&#x7F29;&#x683C;&#x5F0F;&amp;&#x975E;&#x538B;&#x7F29;&#x683C;&#x5F0F;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#轻钱包-amp-SPV验证机制"><span class="nav-number">2.7.</span> <span class="nav-text"><a href="#&#x8F7B;&#x94B1;&#x5305;-amp-SPV&#x9A8C;&#x8BC1;&#x673A;&#x5236;" class="headerlink" title="&#x8F7B;&#x94B1;&#x5305;&amp;SPV&#x9A8C;&#x8BC1;&#x673A;&#x5236;"></a>&#x8F7B;&#x94B1;&#x5305;&amp;SPV&#x9A8C;&#x8BC1;&#x673A;&#x5236;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#私钥的生成建议"><span class="nav-number">2.8.</span> <span class="nav-text"><a href="#&#x79C1;&#x94A5;&#x7684;&#x751F;&#x6210;&#x5EFA;&#x8BAE;" class="headerlink" title="&#x79C1;&#x94A5;&#x7684;&#x751F;&#x6210;&#x5EFA;&#x8BAE;"></a>&#x79C1;&#x94A5;&#x7684;&#x751F;&#x6210;&#x5EFA;&#x8BAE;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#挖矿"><span class="nav-number">2.9.</span> <span class="nav-text"><a href="#&#x6316;&#x77FF;" class="headerlink" title="&#x6316;&#x77FF;"></a>&#x6316;&#x77FF;</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#区块链安全"><span class="nav-number">3.</span> <span class="nav-text"><a href="#&#x533A;&#x5757;&#x94FE;&#x5B89;&#x5168;" class="headerlink" title="&#x533A;&#x5757;&#x94FE;&#x5B89;&#x5168;"></a>&#x533A;&#x5757;&#x94FE;&#x5B89;&#x5168;</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#可塑性攻击"><span class="nav-number">3.1.</span> <span class="nav-text"><a href="#&#x53EF;&#x5851;&#x6027;&#x653B;&#x51FB;" class="headerlink" title="&#x53EF;&#x5851;&#x6027;&#x653B;&#x51FB;"></a>&#x53EF;&#x5851;&#x6027;&#x653B;&#x51FB;</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">TomKK</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://http-tomkklalala-github-io.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2018/01/21/学习区块链/';
          this.page.identifier = '2018/01/21/学习区块链/';
          this.page.title = '学习比特币';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://http-tomkklalala-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.3"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("1uk3Vw0sydAghlwOnBUGYRMn-gzGzoHsz", "op4ebrtGIe4wP41x2oJjqocF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
