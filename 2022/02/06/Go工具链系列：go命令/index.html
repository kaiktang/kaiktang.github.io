<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kaiktang.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"algolia":{"appID":"FBQ33HXA0Q","apiKey":"5a256d1a0d5075a6a17b29fbae8cdbdc","indexName":"blog","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="前言这篇文章收集了目前go提供的命令，这本身是一件很简单的事情，也许会有人认为这类文档类的整理是没有价值的用的时候去看官方手册不就行了吗。 为什么要做这样一件事呢，对于我而言，在看开源代码的时候有时会有感觉：原来go还提供了这个能力吗？每当这种时候，我就会心里立志要完整过一下go的文档。我期望通过整理一遍这些命令，能让我心里对go提供的能力大致有个整体印象，将来遇到问题时能知道大致搜索的方向去搜索">
<meta property="og:type" content="article">
<meta property="og:title" content="Go工具链系列：go命令">
<meta property="og:url" content="http://kaiktang.github.io/2022/02/06/Go%E5%B7%A5%E5%85%B7%E9%93%BE%E7%B3%BB%E5%88%97%EF%BC%9Ago%E5%91%BD%E4%BB%A4/index.html">
<meta property="og:site_name" content="kaiktang&#39;s blogs">
<meta property="og:description" content="前言这篇文章收集了目前go提供的命令，这本身是一件很简单的事情，也许会有人认为这类文档类的整理是没有价值的用的时候去看官方手册不就行了吗。 为什么要做这样一件事呢，对于我而言，在看开源代码的时候有时会有感觉：原来go还提供了这个能力吗？每当这种时候，我就会心里立志要完整过一下go的文档。我期望通过整理一遍这些命令，能让我心里对go提供的能力大致有个整体印象，将来遇到问题时能知道大致搜索的方向去搜索">
<meta property="og:locale">
<meta property="article:published_time" content="2022-02-06T09:53:27.000Z">
<meta property="article:modified_time" content="2022-02-07T12:04:01.000Z">
<meta property="article:author" content="kaiktang">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://kaiktang.github.io/2022/02/06/Go%E5%B7%A5%E5%85%B7%E9%93%BE%E7%B3%BB%E5%88%97%EF%BC%9Ago%E5%91%BD%E4%BB%A4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Go工具链系列：go命令 | kaiktang's blogs</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8714a47efb513991b4862eafeadb6a3d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kaiktang's blogs</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://kaiktang.github.io/2022/02/06/Go%E5%B7%A5%E5%85%B7%E9%93%BE%E7%B3%BB%E5%88%97%EF%BC%9Ago%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="kaiktang">
      <meta itemprop="description" content="学而后知不足">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kaiktang's blogs">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Go工具链系列：go命令
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-06 17:53:27" itemprop="dateCreated datePublished" datetime="2022-02-06T17:53:27+08:00">2022-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 20:04:01" itemprop="dateModified" datetime="2022-02-07T20:04:01+08:00">2022-02-07</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/02/06/Go%E5%B7%A5%E5%85%B7%E9%93%BE%E7%B3%BB%E5%88%97%EF%BC%9Ago%E5%91%BD%E4%BB%A4/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/02/06/Go工具链系列：go命令/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这篇文章收集了目前go提供的命令，这本身是一件很简单的事情，也许会有人认为这类文档类的整理是没有价值的用的时候去看官方手册不就行了吗。</p>
<p>为什么要做这样一件事呢，对于我而言，在看开源代码的时候有时会有感觉：原来go还提供了这个能力吗？每当这种时候，我就会心里立志要完整过一下go的文档。我期望通过整理一遍这些命令，能让我心里对go提供的能力大致有个整体印象，将来遇到问题时能知道大致搜索的方向去搜索。</p>
<span id="more"></span>
<h1 id="go命令"><a href="#go命令" class="headerlink" title="go命令"></a>go命令</h1><p>Go命令是用来管理go代码的工具。</p>
<p>用法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> &lt;command&gt; [arguments]</span><br></pre></td></tr></table></figure>
<h2 id="go-bug-报告go语言的bug"><a href="#go-bug-报告go语言的bug" class="headerlink" title="go bug: 报告go语言的bug"></a>go bug: 报告go语言的bug</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> bug</span><br></pre></td></tr></table></figure>
<p>这个命令会打开默认浏览器，然后发起一个新的bug报告。这个报告包含了有用的系统信息。</p>
<h2 id="go-build-编译包和依赖"><a href="#go-build-编译包和依赖" class="headerlink" title="go build: 编译包和依赖"></a>go build: 编译包和依赖</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build [-o output] [build flags] [packages]</span><br></pre></td></tr></table></figure>
<p>这个命令会编译由<code>import path</code>指定的一个或多个<code>package</code>，但是并不会将最终得到的二进制放到<code>GOBIN</code>中。</p>
<p>如果参数指定的是一些的来自同一个目录的<code>.go</code>文件，那么<code>build</code>命令会将它们当成一个独立的<code>package</code>进行编译。</p>
<p>当编译package的时候，<code>build</code>会忽略以<code>_test.go</code>结尾的文件。</p>
<p>当编译只含有一个main包的代码时，<code>build</code>会将生成的二进制命名为第一个源代码的名字或者为源码目录的名称，例如：</p>
<ul>
<li><code>go build ed.go rx.go</code>会得到<code>ed</code>或者<code>ed.exe</code></li>
<li><code>go build unix/sam</code>会得到<code>sam</code>或者<code>sam.exe</code></li>
</ul>
<p>当编译多个<code>package</code>或者一个非main包的时候，<code>build</code>会编译这些<code>package</code>但是会丢弃编译得到的对象文件，也就是说此时<code>build</code>只是提供一种检验<code>package</code>是否可以被编译的作用。</p>
<p><code>-o</code>选项会强制build命令将编译得到的二进制或者对象文件输出到指定的文件或者目录，而非上面讲的默认行为。</p>
<p><code>-i</code>选项会安装目标的依赖的package，该选项已经被弃用。被编译的package默认会被缓存。</p>
<p>下面的构建选项是被build，clean，get，install，list，run和test命令所共用：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
<th>补充</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>强制重新构建package</td>
<td>即不使用缓存</td>
</tr>
<tr>
<td>-n</td>
<td>仅仅打印出要执行的命令而不是运行它们</td>
<td></td>
</tr>
<tr>
<td>-p n</td>
<td>可以并行运行的程序的数量，程序可以是build或者测试二进制。n的默认值为GOMAXPROCS，即为可用CPU的数量。</td>
<td></td>
</tr>
<tr>
<td>-race</td>
<td>启用数据竞态检查</td>
<td></td>
</tr>
<tr>
<td>-msan</td>
<td>enable interoperation with memory sanitizer.<br/>Supported only on linux/amd64, linux/arm64 and only with Clang/LLVM as the host C compiler.<br/>On linux/arm64, pie build mode will be used.</td>
<td>msan(memory sanitizer)是clang和gcc的一个特性，通过在C语言中插入内存错误自动检测代码。这并不适用于Go程序，因为Go内存都是被初始化过的内存，但是对于使用了cgo的程序会很有用。</td>
</tr>
<tr>
<td>-v</td>
<td>打印出被编译的包名</td>
<td></td>
</tr>
<tr>
<td>-work</td>
<td>打印出临时工作目录的名称并且在任务结束后不会删除工作目录。</td>
<td></td>
</tr>
<tr>
<td>-x</td>
<td>打印出编译过程中的命令</td>
<td></td>
</tr>
<tr>
<td>-asmflags ‘[pattern=]arg list’</td>
<td>每次go tool asm工具调用的时候传递的参数</td>
<td></td>
</tr>
<tr>
<td>-buildmode mode</td>
<td>使用的构建模式</td>
<td>- <code>archive</code>: 编译成静态链接库，main包会被忽略<br />- <code>c-archive</code>: 传入的包列表中只能包含一个main包。代码也会被编译为静态链接库文件，但是里面的可供调用的符号只能是哪些通过//export指定的函数<br />- <code>c-shared</code>: 同上，但是编译得到的是静态链接库<br />default: 传入的main包会被编译成可执行程序，那些非main包会被编译为静态链接库<br />- <code>shared</code>: 将所有传入的非main包都编译成一个动态链接库，main包会被忽略<br />- <code>exe</code>: 将传入的所有main包构建为可执行程序，非main包会被忽略<br /><code>pie</code>: 构建出position independent executable，也就是在二进制每次运行的时候都会被加载到虚拟内存中的不同地址，这使用使用ROP攻击更难实施。非main包会被忽略<br />- <code>plugin</code>: 将所有非main包编译为go plugin，非main包会被忽略</td>
</tr>
<tr>
<td>-compiler name</td>
<td>指定编译器，作为runtime.Compiler，可以是gccgo或者gc</td>
<td></td>
</tr>
<tr>
<td>-gccgoflags ‘[pattern=arg list]’</td>
<td>传给gccgo compiler/linker的参数</td>
<td></td>
</tr>
<tr>
<td>gcflags ‘[pattern=]arg list’</td>
<td>传给go tool compile的参数</td>
<td></td>
</tr>
<tr>
<td>-installsuffix suffix</td>
<td>指定软件安装目录中后缀，用于区分特殊编译参数和默认编译参数的产物</td>
<td>试了以后似乎没有生效</td>
</tr>
<tr>
<td>-ldflags [pattern=]arg list</td>
<td>传递给go tool link的参数</td>
<td></td>
</tr>
<tr>
<td>-mod mode</td>
<td>使用何种模式进行编译。<br />- <code>readonly</code>: 忽略vendor目录并且如果go.mod需要更新的话报告错误<br />- <code>vendor</code>: 使用vendor目录来进行构建。不使用网络或者模块缓存<br />- <code>mod</code>: 忽略vendor目录并且自动更新go.mod</td>
<td>默认来说，如果项目目录中有vendor文件夹，并且go.mod中设置的go版本大于等于1.14，那么go命令将默认使用-mod=vendor</td>
</tr>
<tr>
<td>-modcacherw</td>
<td>让新创建的模块缓存可读可写，而不是只读</td>
<td></td>
</tr>
<tr>
<td>-modfile file</td>
<td>指定读写另一个go.mod文件，而非模块根目录中的那个</td>
<td>虽然可以指定别的go.mod，但是模块根目录内的go.mod还是必须存在，用于确定哪个目录是模块根目录</td>
</tr>
<tr>
<td>-overlay file</td>
<td>读取一个JSON配置文件，用于提供覆盖默认构建行为的配置。这个文件是一个JSON文件并且只有一个字段，名为’Replace’，该字段将每个磁盘文件路径映射到它的备份文件路径。</td>
<td>为了使用-overlay选项有一些限制：cgo中include的文件一定要和使用到它的go文件在同一个目录。另外overlays不会在go run和go test中生效</td>
</tr>
<tr>
<td>-pkgdir dir</td>
<td>指定安装和加载所有包的目录</td>
<td></td>
</tr>
<tr>
<td>-tags tag,list</td>
<td>接受一个用逗号分隔的构建tag列表</td>
<td>用于条件编译</td>
</tr>
<tr>
<td>-trimpath</td>
<td>将生成得到的二进制中的所有文件系统路径移除。对于标准库，将使用go作为路径前缀，或者模块路径@version（当使用module模式），或者import path（如果使用的GOPATH模式）</td>
<td>由于在panic或者动态获取堆栈的时候，可能会暴露出原始机器上的编译路径，可以通过该选项进行隐藏</td>
</tr>
<tr>
<td>-toolexec ‘cmd args’</td>
<td>用来调用像vet或者asm这样的工具链程序</td>
<td>可以指定一个程序来启动编译器，从而介入编译的过程。<br />比如使用<code>-toolexec=/home/tomkk/go/bin/some-tool</code>来启动go build，将会得到<br/><code>/.../some-tool $GOROOT/.../compile</code></td>
</tr>
</tbody>
</table>
<p>对于参数<code>-asmflags</code>，<code>-gccgoflags</code>，<code>-gcflags</code>和<code>-ldflags</code>，接受一个使用空格分隔的参数列表用来向构建过程中使用的底层工具传递参数。对于含有空格的参数，可以使用单括号或者双括号进行包裹。参数前可以先以包模式（pattern）和一个<code>=</code>作为前缀，这样可以限制参数仅仅应用于匹配包模式（pattern）的包。如果没有指定模式，那么参数列表将仅应用于命令行中指定的包。可以为不同的包指定不同的参数，如果一个包匹配多个包模式，那么最后一个匹配的模式将生效。</p>
<p>例如：<code>go build -gcflags=-S fmt</code>仅仅打印出fmt包的汇编，而<code>go build -gcflags=all=-S fmt</code>则打印出fmt以及它的所有依赖的汇编。</p>
<ul>
<li><code>go help packages</code>：查看关于指定包相关的信息</li>
<li><code>go help gopath</code>：查看包和二进制的安装目录</li>
<li><code>go help c</code>：查看go和c之间的相互调用的相关信息</li>
</ul>
<h2 id="go-clean-清除对象文件和缓存"><a href="#go-clean-清除对象文件和缓存" class="headerlink" title="go clean: 清除对象文件和缓存"></a>go clean: 清除对象文件和缓存</h2><p><code>go clean [clean flags] [build flags] [packages]</code></p>
<p>go clean会删除目录中的对象文件。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-i</td>
<td>清除go install创建的库文件或者可执行文件</td>
</tr>
<tr>
<td>-n</td>
<td>打印出要执行的命令，但是不执行</td>
</tr>
<tr>
<td>-r</td>
<td>递归的执行，包含依赖</td>
</tr>
<tr>
<td>-x</td>
<td>在执行时打印出执行的命令</td>
</tr>
<tr>
<td>-cache</td>
<td>移除所有go build的缓存</td>
</tr>
<tr>
<td>-testcache</td>
<td>过期所有存在于go build缓存中的测试结果</td>
</tr>
<tr>
<td>-modcache</td>
<td>清除所有module的下载缓存</td>
</tr>
</tbody>
</table>
<h2 id="go-doc-显示包或者符号的文档"><a href="#go-doc-显示包或者符号的文档" class="headerlink" title="go doc: 显示包或者符号的文档"></a>go doc: 显示包或者符号的文档</h2><p><code>go doc [doc flags] [package|[package.]symbol[.methodOrField]]</code></p>
<p>go doc会打印出参数中指定的元素的文档注释。</p>
<p>go doc接受没有，一个或者两个参数。</p>
<ul>
<li><code>go doc</code>：打印出当前目录中的包</li>
<li><code>go doc &lt;pkg&gt;</code></li>
<li><code>go doc &lt;sym&gt;[.&lt;methodOrField&gt;]</code></li>
<li><code>go doc [&lt;pkg&gt;.]&lt;sym&gt;[.&lt;methodOrField&gt;]</code></li>
<li><code>go doc [&lt;pkg&gt;.][&lt;sym&gt;.]&lt;methodOrField&gt;</code></li>
</ul>
<p>go doc会通过广度优先算法进行遍历所有包，优先遍历GOROOT中的文件，再是GOPATH中的文件。</p>
<p>包路径可以是一个全路径也可以是一个路径后缀。像<code>.</code>还有<code>...</code>是不被不支持的。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-all</td>
<td>展示包的所有文档</td>
</tr>
<tr>
<td>-c</td>
<td>大小写敏感</td>
</tr>
<tr>
<td>-cmd</td>
<td>将main包当成普通的包。否则main包的导出的符号将在其包文档中隐藏</td>
</tr>
<tr>
<td>-short</td>
<td>每个符号只显示一行</td>
</tr>
<tr>
<td>-src</td>
<td>显示符号的完整源代码</td>
</tr>
<tr>
<td>-u</td>
<td>显示导出的和未导出的符号，方法和字段</td>
</tr>
</tbody>
</table>
<h2 id="go-env-打印出go环境信息"><a href="#go-env-打印出go环境信息" class="headerlink" title="go env: 打印出go环境信息"></a>go env: 打印出go环境信息</h2><p><code>go env [-json] [-u] [-w] [var ...]</code></p>
<p>go env会打印出Go的环境信息。</p>
<p>默认env会以shell脚本的方式打印信息。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-json</td>
<td>使用JSON格式打印出环境信息</td>
</tr>
<tr>
<td>-u</td>
<td>重置指定变量的值。<br/>例如go env -u NAME</td>
</tr>
<tr>
<td>-w</td>
<td>修改指定变量的值。<br/>例如go env -w NAME=VALUE</td>
</tr>
</tbody>
</table>
<h2 id="go-fix-自动解决升级go导致的不兼容API"><a href="#go-fix-自动解决升级go导致的不兼容API" class="headerlink" title="go fix: 自动解决升级go导致的不兼容API"></a>go fix: 自动解决升级go导致的不兼容API</h2><p><code>go fix [packages]</code></p>
<p>对指定包运行<code>cmd/fix</code>。</p>
<p>在升级了Go的新版本后，<code>cmd/fix</code>会找到程序中使用到了旧API的代码，并重写为新的API。</p>
<p><code>go tool fix [-r name,...] [path ...]</code></p>
<p>如果path是一个文件，那么go tool fix会重写该文件。如果path是一个目录，那么go tool fix会重写该目录树下的所有文件。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-diff</td>
<td>仅仅打印出需要修改的地方，而不实际进行重写</td>
</tr>
<tr>
<td>-r</td>
<td>限制进行的重写，可以通过go tool fix -help查看可选的重写类型</td>
</tr>
</tbody>
</table>
<h2 id="go-fmt-格式化源码"><a href="#go-fmt-格式化源码" class="headerlink" title="go fmt: 格式化源码"></a>go fmt: 格式化源码</h2><p><code>go fmt [-n] [-x] [packages]</code></p>
<p>该命令会在指定包上运行<code>gofmt -l -w</code>。它会打印出被修改的文件的名称。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>打印命令并执行</td>
</tr>
<tr>
<td>-x</td>
<td>打印命令，但是不执行</td>
</tr>
<tr>
<td>-mod</td>
<td>支持readonly或vendor，用于指定使用的模块下载模式</td>
</tr>
</tbody>
</table>
<h2 id="go-generate-generate-Go-files-by-processing-source"><a href="#go-generate-generate-Go-files-by-processing-source" class="headerlink" title="go generate: generate Go files by processing source"></a>go generate: generate Go files by processing source</h2><p><code>go generate [-run regexp] [-n] [-v] [-x] [build flags] [file.go... | packages]</code></p>
<p>go generate会扫描所有指定的文件并执行它们指定的指令。</p>
<p>指令的格式为：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate command argument...</span></span><br></pre></td></tr></table></figure>
<p>go generate并不会去解析文件，所以注释里面像指令一样的字符串都会被当成指令被执行。</p>
<p>通过如下语法可以传达出不希望程序员或者程序去修改该文件的语义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^<span class="comment">// Code generated .* DO NOT EDIT\.$</span></span><br></pre></td></tr></table></figure>
<p>这一行必须出现在第一个非注释非空代码前。</p>
<p>go generate在执行前会设置如下环境变量：</p>
<ul>
<li><code>$GOARCH</code></li>
<li><code>$GOOS</code></li>
<li><code>$GOFILE</code></li>
<li><code>$GOLINE</code></li>
<li><code>$GOPACKAGE</code></li>
<li><code>$DOLLAR</code></li>
</ul>
<p>go generate会设置build tag ”generate“。</p>
<p>如下形式的指令：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate -command xxx args...</span></span><br></pre></td></tr></table></figure>
<p>可以被用来声明命令别名，比如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate -command foo go tool foo</span></span><br></pre></td></tr></table></figure>
<p>定义了一个foo命令，代表go tool foo。</p>
<p>go generate只会处理那些有合法的包定义语句的源代码文件，如果一个文件的执行出错，那个包下的其他文件将都会被跳过。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>-run=”xxx”</td>
<td>指定一个正则表达式来匹配要执行的命令</td>
</tr>
<tr>
<td>-v</td>
<td>打印出正在处理的包名和文件名</td>
</tr>
<tr>
<td>-n</td>
<td>打印出将要执行的命令</td>
</tr>
<tr>
<td>-x</td>
<td>边执行命令边打印出命令</td>
</tr>
</tbody>
</table>
<h2 id="go-get-add-dependencies-to-current-module-and-install-them"><a href="#go-get-add-dependencies-to-current-module-and-install-them" class="headerlink" title="go get: add dependencies to current module and install them"></a>go get: add dependencies to current module and install them</h2><p><code>go get [-d] [-t] [-u] [-v] [build flags] [packages]</code></p>
<p>下面介绍的是在module模式下的go get行为：</p>
<ul>
<li><code>go get example.com/pkg</code>：为一个模块增加依赖或者将模块的包升级到最新版本</li>
<li><code>go get example.com/pkg@v1.2.3</code>：将一个包升级到或者降级到指定版本</li>
<li><code>go get example.com/mod@none</code>：将一个依赖包从模块中移除</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>-t</td>
<td>让go get也一并下载构建test所需要的包</td>
</tr>
<tr>
<td>-u</td>
<td>更新指定包，使用最新的minor或者patch版本号</td>
</tr>
<tr>
<td>-u=patch</td>
<td>仅更新指定包的patch版本号</td>
</tr>
<tr>
<td>-d</td>
<td>不去构建或者安装依赖，而仅仅去下载源码还有更新go.mod</td>
</tr>
</tbody>
</table>
<p>要查看go get在gopath模式下的行为，通过<code>go help gopath-get</code>查看。</p>
<h2 id="go-install-compile-and-install-packages-and-dependencies"><a href="#go-install-compile-and-install-packages-and-dependencies" class="headerlink" title="go install: compile and install packages and dependencies"></a>go install: compile and install packages and dependencies</h2><p><code>go install [build flags] [packages]</code></p>
<p>编译并将二进制安装到<code>$GOBIN</code>目录下。如果该环境变量没有被设置，那么它的默认值为<code>$GOPATH/bin</code>或者<code>$HOME/go/bin</code>。在<code>$GOROOT</code>下的可执行文件会被安装到<code>$GOROOT/bin</code>下或者<code>$GOTOOLDIR</code>而不是<code>$GOBIN</code>下。</p>
<p>如果参数中存在版本后缀（类似：@latest或者@v1.0.0），go install将会忽略当前目录或者任何父目录中的go.mod文件，并运行在module-aware模式下。在module-aware模式下，go install运行在main module的上下文环境中。main module指的是包含当前目录的那个module。</p>
<p>如果参数中不存在版本后缀，那么go install是运行在module-aware模式还是GOPATH模式将取决于GO111MODULE环境变量以及是否存在go.mod。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>-i</td>
<td>将包的依赖也一并安装。已弃用，目前默认就会进行依赖的编译和缓存</td>
</tr>
</tbody>
</table>
<h2 id="go-list-list-packages-or-modules"><a href="#go-list-list-packages-or-modules" class="headerlink" title="go list: list packages or modules"></a>go list: list packages or modules</h2><p><code>go list [-f format] [-json] [-m] [list flags] [build flags] [packages]</code></p>
<p>go list会一个一行的列出所有包。</p>
<p>默认的输出格式是包的import path。</p>
<p>在vendor目录中的包的import path会加上vendor前缀，比如会输出”d/vendor/p”，而不是”p”</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>-f</td>
<td>控制输出的形式。使用的格式字符串遵守package template语法，默认的输出格式等效为：’&#123;&#123;.ImportPath&#125;&#125;’</td>
</tr>
<tr>
<td>-json</td>
<td>控制输出的格式为json</td>
</tr>
<tr>
<td>-compiled</td>
<td>让go list设置CompiledGoFiles为编译器所处理的文件</td>
</tr>
<tr>
<td>-deps</td>
<td>不止遍历包还包含他们的依赖。通过深度优先后序遍历的顺序遍历。</td>
</tr>
<tr>
<td>-e</td>
<td>用于设置go list对于错误的包的行为，错误的包是指那些不能被找到的或者格式不正确的包。默认，go list会在stderr中打印那些错误的包。如果使用-e，那么go list会继续处理错误的包，而不是忽略。</td>
</tr>
<tr>
<td>-exported</td>
<td>设置Export字段为包含包的最新导出信息的文件名</td>
</tr>
<tr>
<td>-find</td>
<td>让go list不去解析包的依赖。Imports和Deps字段将为空</td>
</tr>
<tr>
<td>-test</td>
<td>不止打印出包名还打印出他们的test二进制。打印出来的test二进制的import path后面会跟随一个.test后缀，比如math/rand.test。</td>
</tr>
<tr>
<td>-m</td>
<td>打印module而不是package。对于module会打印出module path和其版本号，如果有replace配置的话，也会打印出来。</td>
</tr>
<tr>
<td>-u</td>
<td>增加可用的升级信息。当模块存在更新版本的时候，会设置Module.Update字段为更新的模块</td>
</tr>
<tr>
<td>-versions</td>
<td>设置Module.Versions字段为该模块的所有已知版本号，并按照语义版本号进行排序，从老到新</td>
</tr>
<tr>
<td>-retracted</td>
<td>让go list输出retracted module versions的信息。retracted module是在go1.16中提出的概念，用于让模块的发布者有能力回滚或者说向使用者屏蔽某个版本的模块</td>
</tr>
<tr>
<td>all</td>
<td>all指代当前目录对应的模块以及该模块的依赖</td>
</tr>
</tbody>
</table>
<p>对于<code>-f</code>选项指定的格式字符串传入的结构体为：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Package <span class="keyword">struct</span> &#123;</span><br><span class="line">    Dir           <span class="type">string</span>   <span class="comment">// directory containing package sources</span></span><br><span class="line">    ImportPath    <span class="type">string</span>   <span class="comment">// import path of package in dir</span></span><br><span class="line">    ImportComment <span class="type">string</span>   <span class="comment">// path in import comment on package statement</span></span><br><span class="line">    Name          <span class="type">string</span>   <span class="comment">// package name</span></span><br><span class="line">    Doc           <span class="type">string</span>   <span class="comment">// package documentation string</span></span><br><span class="line">    Target        <span class="type">string</span>   <span class="comment">// install path</span></span><br><span class="line">    Shlib         <span class="type">string</span>   <span class="comment">// the shared library that contains this package (only set when -linkshared)</span></span><br><span class="line">    Goroot        <span class="type">bool</span>     <span class="comment">// is this package in the Go root?</span></span><br><span class="line">    Standard      <span class="type">bool</span>     <span class="comment">// is this package part of the standard Go library?</span></span><br><span class="line">    Stale         <span class="type">bool</span>     <span class="comment">// would &#x27;go install&#x27; do anything for this package?</span></span><br><span class="line">    StaleReason   <span class="type">string</span>   <span class="comment">// explanation for Stale==true</span></span><br><span class="line">    Root          <span class="type">string</span>   <span class="comment">// Go root or Go path dir containing this package</span></span><br><span class="line">    ConflictDir   <span class="type">string</span>   <span class="comment">// this directory shadows Dir in $GOPATH</span></span><br><span class="line">    BinaryOnly    <span class="type">bool</span>     <span class="comment">// binary-only package (no longer supported)</span></span><br><span class="line">    ForTest       <span class="type">string</span>   <span class="comment">// package is only for use in named test</span></span><br><span class="line">    Export        <span class="type">string</span>   <span class="comment">// file containing export data (when using -export)</span></span><br><span class="line">    BuildID       <span class="type">string</span>   <span class="comment">// build ID of the compiled package (when using -export)</span></span><br><span class="line">    Module        *Module  <span class="comment">// info about package&#x27;s containing module, if any (can be nil)</span></span><br><span class="line">    Match         []<span class="type">string</span> <span class="comment">// command-line patterns matching this package</span></span><br><span class="line">    DepOnly       <span class="type">bool</span>     <span class="comment">// package is only a dependency, not explicitly listed</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Source files</span></span><br><span class="line">    GoFiles         []<span class="type">string</span>   <span class="comment">// .go source files (excluding CgoFiles, TestGoFiles, XTestGoFiles)</span></span><br><span class="line">    CgoFiles        []<span class="type">string</span>   <span class="comment">// .go source files that import &quot;C&quot;</span></span><br><span class="line">    CompiledGoFiles []<span class="type">string</span>   <span class="comment">// .go files presented to compiler (when using -compiled)</span></span><br><span class="line">    IgnoredGoFiles  []<span class="type">string</span>   <span class="comment">// .go source files ignored due to build constraints</span></span><br><span class="line">    IgnoredOtherFiles []<span class="type">string</span> <span class="comment">// non-.go source files ignored due to build constraints</span></span><br><span class="line">    CFiles          []<span class="type">string</span>   <span class="comment">// .c source files</span></span><br><span class="line">    CXXFiles        []<span class="type">string</span>   <span class="comment">// .cc, .cxx and .cpp source files</span></span><br><span class="line">    MFiles          []<span class="type">string</span>   <span class="comment">// .m source files</span></span><br><span class="line">    HFiles          []<span class="type">string</span>   <span class="comment">// .h, .hh, .hpp and .hxx source files</span></span><br><span class="line">    FFiles          []<span class="type">string</span>   <span class="comment">// .f, .F, .for and .f90 Fortran source files</span></span><br><span class="line">    SFiles          []<span class="type">string</span>   <span class="comment">// .s source files</span></span><br><span class="line">    SwigFiles       []<span class="type">string</span>   <span class="comment">// .swig files</span></span><br><span class="line">    SwigCXXFiles    []<span class="type">string</span>   <span class="comment">// .swigcxx files</span></span><br><span class="line">    SysoFiles       []<span class="type">string</span>   <span class="comment">// .syso object files to add to archive</span></span><br><span class="line">    TestGoFiles     []<span class="type">string</span>   <span class="comment">// _test.go files in package</span></span><br><span class="line">    XTestGoFiles    []<span class="type">string</span>   <span class="comment">// _test.go files outside package</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Embedded files</span></span><br><span class="line">    EmbedPatterns      []<span class="type">string</span> <span class="comment">// //go:embed patterns</span></span><br><span class="line">    EmbedFiles         []<span class="type">string</span> <span class="comment">// files matched by EmbedPatterns</span></span><br><span class="line">    TestEmbedPatterns  []<span class="type">string</span> <span class="comment">// //go:embed patterns in TestGoFiles</span></span><br><span class="line">    TestEmbedFiles     []<span class="type">string</span> <span class="comment">// files matched by TestEmbedPatterns</span></span><br><span class="line">    XTestEmbedPatterns []<span class="type">string</span> <span class="comment">// //go:embed patterns in XTestGoFiles</span></span><br><span class="line">    XTestEmbedFiles    []<span class="type">string</span> <span class="comment">// files matched by XTestEmbedPatterns</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cgo directives</span></span><br><span class="line">    CgoCFLAGS    []<span class="type">string</span> <span class="comment">// cgo: flags for C compiler</span></span><br><span class="line">    CgoCPPFLAGS  []<span class="type">string</span> <span class="comment">// cgo: flags for C preprocessor</span></span><br><span class="line">    CgoCXXFLAGS  []<span class="type">string</span> <span class="comment">// cgo: flags for C++ compiler</span></span><br><span class="line">    CgoFFLAGS    []<span class="type">string</span> <span class="comment">// cgo: flags for Fortran compiler</span></span><br><span class="line">    CgoLDFLAGS   []<span class="type">string</span> <span class="comment">// cgo: flags for linker</span></span><br><span class="line">    CgoPkgConfig []<span class="type">string</span> <span class="comment">// cgo: pkg-config names</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Dependency information</span></span><br><span class="line">    Imports      []<span class="type">string</span>          <span class="comment">// import paths used by this package</span></span><br><span class="line">    ImportMap    <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span> <span class="comment">// map from source import to ImportPath (identity entries omitted)</span></span><br><span class="line">    Deps         []<span class="type">string</span>          <span class="comment">// all (recursively) imported dependencies</span></span><br><span class="line">    TestImports  []<span class="type">string</span>          <span class="comment">// imports from TestGoFiles</span></span><br><span class="line">    XTestImports []<span class="type">string</span>          <span class="comment">// imports from XTestGoFiles</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Error information</span></span><br><span class="line">    Incomplete <span class="type">bool</span>            <span class="comment">// this package or a dependency has an error</span></span><br><span class="line">    Error      *PackageError   <span class="comment">// error loading package</span></span><br><span class="line">    DepsErrors []*PackageError <span class="comment">// errors loading dependencies</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PackageError <span class="keyword">struct</span> &#123;</span><br><span class="line">    ImportStack   []<span class="type">string</span> <span class="comment">// shortest path from package named on command line to this one</span></span><br><span class="line">    Pos           <span class="type">string</span>   <span class="comment">// position of error (if present, file:line:col)</span></span><br><span class="line">    Err           <span class="type">string</span>   <span class="comment">// the error itself</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Module <span class="keyword">struct</span> &#123;</span><br><span class="line">    Path      <span class="type">string</span>       <span class="comment">// module path</span></span><br><span class="line">    Version   <span class="type">string</span>       <span class="comment">// module version</span></span><br><span class="line">    Versions  []<span class="type">string</span>     <span class="comment">// available module versions (with -versions)</span></span><br><span class="line">    Replace   *Module      <span class="comment">// replaced by this module</span></span><br><span class="line">    Time      *time.Time   <span class="comment">// time version was created</span></span><br><span class="line">    Update    *Module      <span class="comment">// available update, if any (with -u)</span></span><br><span class="line">    Main      <span class="type">bool</span>         <span class="comment">// is this the main module?</span></span><br><span class="line">    Indirect  <span class="type">bool</span>         <span class="comment">// is this module only an indirect dependency of main module?</span></span><br><span class="line">    Dir       <span class="type">string</span>       <span class="comment">// directory holding files for this module, if any</span></span><br><span class="line">    GoMod     <span class="type">string</span>       <span class="comment">// path to go.mod file used when loading this module, if any</span></span><br><span class="line">    GoVersion <span class="type">string</span>       <span class="comment">// go version used in module</span></span><br><span class="line">    Retracted <span class="type">string</span>       <span class="comment">// retraction information, if any (with -retracted or -u)</span></span><br><span class="line">    Error     *ModuleError <span class="comment">// error loading module</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ModuleError <span class="keyword">struct</span> &#123;</span><br><span class="line">    Err <span class="type">string</span> <span class="comment">// the error itself</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>模板中提供了如下函数：</p>
<ul>
<li><p>join：会调用strings.Join</p>
</li>
<li><p>context：返回build context</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">    GOARCH        <span class="type">string</span>   <span class="comment">// target architecture</span></span><br><span class="line">    GOOS          <span class="type">string</span>   <span class="comment">// target operating system</span></span><br><span class="line">    GOROOT        <span class="type">string</span>   <span class="comment">// Go root</span></span><br><span class="line">    GOPATH        <span class="type">string</span>   <span class="comment">// Go path</span></span><br><span class="line">    CgoEnabled    <span class="type">bool</span>     <span class="comment">// whether cgo can be used</span></span><br><span class="line">    UseAllFiles   <span class="type">bool</span>     <span class="comment">// use files regardless of +build lines, file names</span></span><br><span class="line">    Compiler      <span class="type">string</span>   <span class="comment">// compiler to assume when computing target paths</span></span><br><span class="line">    BuildTags     []<span class="type">string</span> <span class="comment">// build constraints to match in +build lines</span></span><br><span class="line">    ToolTags      []<span class="type">string</span> <span class="comment">// toolchain-specific build constraints</span></span><br><span class="line">    ReleaseTags   []<span class="type">string</span> <span class="comment">// releases the current release is compatible with</span></span><br><span class="line">    InstallSuffix <span class="type">string</span>   <span class="comment">// suffix to use in the name of the install dir</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>module: 接收一个字符串代表模块路径，返回一个Module接口体</p>
</li>
</ul>
<h2 id="go-mod-模块维护相关"><a href="#go-mod-模块维护相关" class="headerlink" title="go mod: 模块维护相关"></a>go mod: 模块维护相关</h2><p><code>go mod &lt;command&gt; [arguments]</code></p>
<h3 id="go-mod-download-将模块下载到本地缓存中"><a href="#go-mod-download-将模块下载到本地缓存中" class="headerlink" title="go mod download: 将模块下载到本地缓存中"></a>go mod download: 将模块下载到本地缓存中</h3><p><code>go mod download [-x] [-json] [modules]</code></p>
<p>可以通过module pattern来指定下载main module的某些依赖，也可以通过path@version来进行指定。如果不指定参数，那么将等效于go mod download all，会下载main module的所有依赖。</p>
<p>通常在运行构建模块的时候，他们的依赖会被自动的下载下来。go mod download的意义一般在于预先构建模块缓存或者为go module proxy计算回复。</p>
<p>默认，该命令不会向stdout写入任何东西。但是它会向stderr中打印过程信息和错误信息。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-json</td>
<td>向stdout用json格式打印下载的模块的信息</td>
</tr>
<tr>
<td>-x</td>
<td>边下载边打印命令</td>
</tr>
</tbody>
</table>
<h3 id="go-mod-edit-编辑go-mod"><a href="#go-mod-edit-编辑go-mod" class="headerlink" title="go mod edit: 编辑go.mod"></a>go mod edit: 编辑go.mod</h3><p><code>go mod edit [editing flags] [-fmt|-print|-json] [go.mod]</code></p>
<p>该命令只会读取go.mod而不是去查找或者解析设置到的模块信息。默认在不指定模块的时候，该模块修改的是主模块的go.mod。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-fmt</td>
<td>整理go.mod格式</td>
</tr>
<tr>
<td>-module</td>
<td>改变模块的路径，也就是module那一行</td>
</tr>
<tr>
<td>-require=path@version<br/>-droprequire=path</td>
<td>新增或移除必需模块的路径和版本。更建议使用go get来间接修改go.mod</td>
</tr>
<tr>
<td>-exclude=path@version<br/>-dropexclude=path@version</td>
<td>增加或者移除一个排除的模块</td>
</tr>
<tr>
<td>-replace=old[@v]=new[@v]</td>
<td>新增一个指定模块的替代。如果没有指定old的版本号，那么替换规则将应用于任何版本的old模块。如果没有指定new的版本号，那么new应该是一个指向new的本地文件系统路径，而非模块路径</td>
</tr>
<tr>
<td>-dropreplace=old[@v]</td>
<td>移除指定模块的replace规则。没有没有指定版本号，那么只会移除没有指定版本号的replace规则</td>
</tr>
<tr>
<td>-retract=version<br/>-dropretract=version</td>
<td>标记指定的一个或者多个版本号已被回退。比如：v1.2.3或者[v1.1.0, v1.1.9]</td>
</tr>
<tr>
<td>-go=version</td>
<td>设置期望的go版本</td>
</tr>
<tr>
<td>-print</td>
<td>打印出修改后go.mod，但是不写回go.mod</td>
</tr>
<tr>
<td>-json</td>
<td>将最终的go.mod以json格式打印出来，但是不写回go.mod</td>
</tr>
</tbody>
</table>
<h3 id="go-mod-graph-打印出模块依赖图"><a href="#go-mod-graph-打印出模块依赖图" class="headerlink" title="go mod graph: 打印出模块依赖图"></a>go mod graph: 打印出模块依赖图</h3><p><code>go mod graph [-go=version]</code></p>
<p>打印出来的依赖图是在应用了替换（replacement）规则之后的。</p>
<p>输出的每一行有两个用空格分隔的字段：一个模块和一个它的必须模块。每个模块是以path@version的形式进行标识，只有main module没有@version后缀。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-go</td>
<td>打印出指定go版本所加载的模块图，而非go.mod中指定的go版本</td>
</tr>
</tbody>
</table>
<h3 id="go-mod-init-在当前目录中初始化新模块"><a href="#go-mod-init-在当前目录中初始化新模块" class="headerlink" title="go mod init: 在当前目录中初始化新模块"></a>go mod init: 在当前目录中初始化新模块</h3><p><code>go mod init [module-path]</code></p>
<p>在当前目录初始化并创建一个新的go.mod文件，也就是在当前目录创建了一个新的模块。</p>
<p>如果module-path参数没有被传入，init会尝试基于.go文件的import comments或者Gopkg.lock这样的vendor配置工具，或者当前当前的目录路径（如果当前目录处于GOPATH中）来推测出module-path。</p>
<p>如果存在像Gopck.lock这样的vendor配置工具，go mod init会尝试从里面读取依赖。</p>
<h3 id="go-mod-tidy-add-missing-and-remove-unused-modules"><a href="#go-mod-tidy-add-missing-and-remove-unused-modules" class="headerlink" title="go mod tidy: add missing and remove unused modules"></a>go mod tidy: add missing and remove unused modules</h3><p><code>go mod tidy [-e] [-v] [-go=version] [-compat=version]</code></p>
<p>go mod tidy会新增缺失的必需依赖，清理掉没有被使用到的依赖，并更新go.sum文件。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-v</td>
<td>将移除的模块打印到stderr</td>
</tr>
<tr>
<td>-e</td>
<td>处理过程中忽略发生的错误</td>
</tr>
<tr>
<td>-go=version</td>
<td>更新go.mod中的go指令，可能会修改依赖的必需模块</td>
</tr>
<tr>
<td>-compat</td>
<td>没看懂。。。The -compat flag preserves any additional checksums needed for the ‘go’ command from the indicated major Go release to successfully load the module graph, and causes tidy to error out if that version of the ‘go’ command would load any imported package from a different module version. By default, tidy acts as if the -compat flag were set to the version prior to the one indicated by the ‘go’ directive in the go.mod file.</td>
</tr>
</tbody>
</table>
<h3 id="go-mod-vendor-拷贝依赖到vendor目录中"><a href="#go-mod-vendor-拷贝依赖到vendor目录中" class="headerlink" title="go mod vendor: 拷贝依赖到vendor目录中"></a>go mod vendor: 拷贝依赖到vendor目录中</h3><p><code>go mod vendor [-e] [-v]</code></p>
<p>向vendor目录中添加构建主模块所需要的所有的依赖，包含测试依赖的包。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-v</td>
<td>打印放入vendor目录中的模块和包名</td>
</tr>
<tr>
<td>-e</td>
<td>在处理过程中忽略错误</td>
</tr>
</tbody>
</table>
<h3 id="go-mod-verify-校验依赖确实含有期望的内容"><a href="#go-mod-verify-校验依赖确实含有期望的内容" class="headerlink" title="go mod verify: 校验依赖确实含有期望的内容"></a>go mod verify: 校验依赖确实含有期望的内容</h3><p><code>go mod verify</code></p>
<p>检查当前在缓存中的所有依赖是否被修改过。</p>
<h3 id="go-mod-why-解释为什么一个包或者模块被需要"><a href="#go-mod-why-解释为什么一个包或者模块被需要" class="headerlink" title="go mod why: 解释为什么一个包或者模块被需要"></a>go mod why: 解释为什么一个包或者模块被需要</h3><p><code>go mod why [-m] [-vendor] packages...</code></p>
<p>go mod why会知道主模块对指定包的最近的依赖路径。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-m</td>
<td>将参数看做是模块路径，并找到对该模块内的任何包的依赖的最短路径</td>
</tr>
<tr>
<td>-vendor</td>
<td>默认go mod why会遍历所有依赖，包含test的依赖，而该选项会排除test的依赖</td>
</tr>
</tbody>
</table>
<p>输出格式为一系列的小结，每个小结代表命令行参数中指定的一个包或者模块，每个小结之间用一个空行分隔。每个小结都用一个注释行#package或者#module开始，代表目标包或者模块。接下来的行每行代表依赖路径中的一段。</p>
<p>例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> mod why golang.org/x/text/language golang.org/x/text/encoding</span><br><span class="line"># golang.org/x/text/language</span><br><span class="line">rsc.io/quote</span><br><span class="line">rsc.io/sampler</span><br><span class="line">golang.org/x/text/language</span><br><span class="line"></span><br><span class="line"># golang.org/x/text/encoding</span><br><span class="line">(main module does not need <span class="keyword">package</span> golang.org/x/text/encoding)</span><br></pre></td></tr></table></figure>
<h2 id="go-run-编译并运行go程序"><a href="#go-run-编译并运行go程序" class="headerlink" title="go run: 编译并运行go程序"></a>go run: 编译并运行go程序</h2><p><code>go run [build flags] [-exec xprog] package [arguments...]</code></p>
<p>可以接受的参数形式有：同一个目录内的go源码文件列表或者是一个导入路径，或者是文件系统路径，或者是一个可以唯一标识一个包的模式，比如<code>go run .</code>或者<code>go run my/cmd</code></p>
<p>如果参数中包含了版本后缀，类似：@lastest或者@v1.0.0。这会忽略当前目录和它父目录中的go.mod文件，直接去下载并运行对应的包，并不影响主模块的依赖。</p>
<p>如果参数中没有包含版本后缀，那么go run是运行在模块感知（module-aware)模式还是GOPATH模式下取决于<code>GO111MODULE</code>环境变量的值以及是否存在go.mod文件。如果是在模块感知模式下，go run运行在当前主模块的上下文环境中。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-exec xprog</td>
<td>默认情况下go run直接运行编译得到的二进制。如果设置了该选项，go run将使用xprog调用该二进制。</td>
</tr>
</tbody>
</table>
<p>如果-exec选项没有被设置，并且GOOS或者GOARCH不同于系统默认，那么go run将会去查找<code>go_$GOOS_$GOARCH_exec</code>并运行。</p>
<p>go run的返回值不代表二进制的返回值。</p>
<h2 id="go-test-运行包的测试"><a href="#go-test-运行包的测试" class="headerlink" title="go test: 运行包的测试"></a>go test: 运行包的测试</h2><p><code>go test [build/test flags] [packages] [build/test flags &amp; test binary flags]</code></p>
<p>go test会自动运行包内单元测试，并以如下格式打印出测试结果：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ok   archive/tar   <span class="number">0.011</span>s</span><br><span class="line">FAIL archive/zip   <span class="number">0.022</span>s</span><br><span class="line">ok   compress/gzip <span class="number">0.033</span>s</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>后面会跟着每个测试失败的包的错误报告。</p>
<p>go test会忽略所有文件名以”_“包括（_test.go）或者”.”作为前缀的文件。</p>
<p>声明在包名以”_test”为后缀的包内的测试文件会被作为一个单独的包进行编译，然后再和主测试二进制进行链接和运行。</p>
<p>go test会忽略名为<code>testdata</code>的目录，因为该目录被认为存在测试的辅助数据。</p>
<p>在构建测试二进制的时候，go test会先运行go vet，如果go vet检测到了重大问题，那么go test会报告错误并拒绝执行测试。</p>
<p>go test可以运行在两种不同模式下：</p>
<ul>
<li>本地目录（local directory）模式：当go test没有指定任何包时。在这种模式下，go test会编译并运行当前目录内的测试文件。在这个模式下，缓存会被禁用。</li>
<li>包列表（package list）模式：当go test显式指定了包时，比如go test ./…或者go test .等。在这个模式下， go test会编译并运行命令行内指定的每个包，并缓存那些测试结果为成功的结果以避免重复运行。如果是从缓存中取出的测试结果，那么耗时那一栏将使用（cached）来进行标识。<ul>
<li>判定命中缓存的规则为：如果是同一个测试二进制而且可缓存（cacheable）的选项都相同。可缓存的选项有<code>-benchtime</code>，<code>-cpu</code>，<code>-list</code>，<code>-parallel</code>，<code>-run</code>，<code>-short</code>，和<code>-v</code>。</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-args</td>
<td>将该参数后面的参数传给测试二进制</td>
</tr>
<tr>
<td>-c</td>
<td>编译得到测试二进制：pkg.test，但是并不运行它，文件名可以通过-o指定</td>
</tr>
<tr>
<td>-exec xprog</td>
<td>使用xprog运行测试二进制</td>
</tr>
<tr>
<td>-i</td>
<td>编译并安装测试的依赖</td>
</tr>
<tr>
<td>-json</td>
<td>将测试输出转换为适合自动化处理的 JSON</td>
</tr>
<tr>
<td>-o file</td>
<td>指定编译后的二进制名</td>
</tr>
<tr>
<td>-bench regexp</td>
<td>只运行匹配该正则表达式的基准测试。默认不会运行任何基准测试。使用-bench .或者-bench=.运行所有的基准测试。</td>
</tr>
<tr>
<td>-benchtime t</td>
<td>指定基准测试运行的时间，t可以是time.Duration，比如-benchtimie 1h30s。也可以是Nx，用于指定运行N次，比如-benchtime 100x</td>
</tr>
<tr>
<td>-count n</td>
<td>运行每个测试和基准测试n此次。样例（example）测试永远只会运行一次。</td>
</tr>
<tr>
<td>-cover</td>
<td>启用覆盖率分析。使用该选项后的编译错误中的行号可能并不匹配原代码的行号</td>
</tr>
<tr>
<td>-covermode set,count,atomic</td>
<td>set: 布尔值。默认值。代表这个语句是否运行了。<br/>count: 整型。代表这个语句运行了多少次<br/>atomic: 整型。-race模式下的默认值。代表在多线程模式下语句运行多少次，会严重影响性能</td>
</tr>
<tr>
<td>-coverpkg pattern1,pattern2,pattern3</td>
<td>对匹配pattern的包内的测试进行覆盖率分析</td>
</tr>
<tr>
<td>-cpu 1,2,4</td>
<td>指定运行测试或者基准测试的一系列GOMAXPROCS的值</td>
</tr>
<tr>
<td>-failfast</td>
<td>如果某个测试失败了，将不再进行下面的测试</td>
</tr>
<tr>
<td>-list regexp</td>
<td>打印出匹配指定正则表达式的单元测试，基准测试或者样例测试</td>
</tr>
<tr>
<td>-parallel n</td>
<td>允许并行执行的t.Parallel函数的数量。默认为GOMAXPROCS</td>
</tr>
<tr>
<td>-run regexp</td>
<td>仅仅运行匹配正则表达式的单元测试和样例测试</td>
</tr>
<tr>
<td>-short</td>
<td>让go test尽量减少测试时间。默认是关闭的</td>
</tr>
<tr>
<td>-timeout d</td>
<td>如果测试时间超过指定的时间，那么就报panic。默认值为10分钟。如果d为0，那么超时机制将被禁用</td>
</tr>
<tr>
<td>-v</td>
<td>打印出所有运行的测试和日志</td>
</tr>
<tr>
<td>-vet list</td>
<td>指定go vet进行的检查。如果值为off，那么不进行vet检查</td>
</tr>
<tr>
<td>-benchmem</td>
<td>打印出基准测试过程中的内存分配数据</td>
</tr>
<tr>
<td>-blockprofile block.out</td>
<td>输出goroutine阻塞分析报告</td>
</tr>
<tr>
<td>-blockprofilerate n</td>
<td>设置runtime.SetBlockProfileRate。控制取样频率为n纳秒</td>
</tr>
<tr>
<td>-coverprofile cover.out</td>
<td>所有测试运行结束之后输出一份覆盖率报告</td>
</tr>
<tr>
<td>-cpuprofile cpu.out</td>
<td>所有测试运行结束之后输出一份cpu报告</td>
</tr>
<tr>
<td>-memprofile mem.out</td>
<td>所有测试运行结束之后输出一份内存分配分析报告</td>
</tr>
<tr>
<td>-memprofilerate n</td>
<td>设置runtime.MemProfileRate，设置内存分析的取样频率</td>
</tr>
<tr>
<td>-mutexprofile metex.out</td>
<td>在所有运行结束之后，输出一份锁竞争分析报告</td>
</tr>
<tr>
<td>-mutexprofilefraction n</td>
<td>对于持有锁的goroutine的堆栈，每n个堆栈取样一个</td>
</tr>
<tr>
<td>-outputdir directory</td>
<td>将分析报告输出到指定目录。默认将输出到go test运行的目录</td>
</tr>
<tr>
<td>-trace trace.out</td>
<td>输出执行的运行数据，包含大量信息，以后会单独写一篇文章介绍</td>
</tr>
</tbody>
</table>
<p>如果想要直接运行编译得到的测试二进制，也可以使用上面列出的选项，下面两个命令是等价的：</p>
<ul>
<li><code>go test -v -myflag testdata -cpuprofile=prof.out</code></li>
<li><code>pkg.test -test.v -myflag testdata -test.cpuprofile=prof.out</code></li>
</ul>
<p>下面两个也是等价的：</p>
<ul>
<li><code>go test -args math</code></li>
<li><code>pkg.test math</code></li>
</ul>
<p>当生成profile的时候，默认也会生成测试二进制。</p>
<p>如果有命令行参数中的包列表，一定要放在那些go test不认识的选项之前。</p>
<h2 id="go-tool-run-specified-go-tool"><a href="#go-tool-run-specified-go-tool" class="headerlink" title="go tool: run specified go tool"></a>go tool: run specified go tool</h2><p><code>go tool [-n] command [args...]</code></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>打印出执行命令并不执行</td>
</tr>
</tbody>
</table>
<p>对于每个tool命令，可以查看：<code>go doc cmd/&lt;command&gt;</code></p>
<h2 id="go-version-print-go-version"><a href="#go-version-print-go-version" class="headerlink" title="go version: print go version"></a>go version: print go version</h2><p><code>go version [-m] [-v] [file ...]</code></p>
<p>如果不指定文件，那么将打印出go自己的版本号。如果指定了文件或者目录，那么go将会递归的遍历目录找到可被识别的go二进制，并输出这个二进制使用的go版本号。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-v</td>
<td>除了可被识别的go二进制外，还输出那些不被识别的文件</td>
</tr>
<tr>
<td>-m</td>
<td>打印出可执行文件的嵌入的模块版本信息</td>
</tr>
</tbody>
</table>
<h2 id="go-vet-检查潜在的程序错误"><a href="#go-vet-检查潜在的程序错误" class="headerlink" title="go vet: 检查潜在的程序错误"></a>go vet: 检查潜在的程序错误</h2><p><code>go vet [-n] [-x] [-vettool prog] [build flags] [vet flags] [packages]</code></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>打印将会被执行的命令，但是并不执行</td>
</tr>
<tr>
<td>-x</td>
<td>边执行边打印命令</td>
</tr>
<tr>
<td>-vettool=prog</td>
<td>选择指定一个不同的分析工具</td>
</tr>
</tbody>
</table>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="kaiktang WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="kaiktang Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/go/" rel="tag"># go</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/20/Raft%E8%A1%A5%E5%85%85/" rel="prev" title="Raft补充">
      <i class="fa fa-chevron-left"></i> Raft补充
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/05/05/Java-AbstractQueuedSynchronizer/" rel="next" title="Java AbstractQueuedSynchronizer">
      Java AbstractQueuedSynchronizer <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#go%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">go命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#go-bug-%E6%8A%A5%E5%91%8Ago%E8%AF%AD%E8%A8%80%E7%9A%84bug"><span class="nav-number">2.1.</span> <span class="nav-text">go bug: 报告go语言的bug</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-build-%E7%BC%96%E8%AF%91%E5%8C%85%E5%92%8C%E4%BE%9D%E8%B5%96"><span class="nav-number">2.2.</span> <span class="nav-text">go build: 编译包和依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-clean-%E6%B8%85%E9%99%A4%E5%AF%B9%E8%B1%A1%E6%96%87%E4%BB%B6%E5%92%8C%E7%BC%93%E5%AD%98"><span class="nav-number">2.3.</span> <span class="nav-text">go clean: 清除对象文件和缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-doc-%E6%98%BE%E7%A4%BA%E5%8C%85%E6%88%96%E8%80%85%E7%AC%A6%E5%8F%B7%E7%9A%84%E6%96%87%E6%A1%A3"><span class="nav-number">2.4.</span> <span class="nav-text">go doc: 显示包或者符号的文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-env-%E6%89%93%E5%8D%B0%E5%87%BAgo%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="nav-number">2.5.</span> <span class="nav-text">go env: 打印出go环境信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-fix-%E8%87%AA%E5%8A%A8%E8%A7%A3%E5%86%B3%E5%8D%87%E7%BA%A7go%E5%AF%BC%E8%87%B4%E7%9A%84%E4%B8%8D%E5%85%BC%E5%AE%B9API"><span class="nav-number">2.6.</span> <span class="nav-text">go fix: 自动解决升级go导致的不兼容API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-fmt-%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%BA%90%E7%A0%81"><span class="nav-number">2.7.</span> <span class="nav-text">go fmt: 格式化源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-generate-generate-Go-files-by-processing-source"><span class="nav-number">2.8.</span> <span class="nav-text">go generate: generate Go files by processing source</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-get-add-dependencies-to-current-module-and-install-them"><span class="nav-number">2.9.</span> <span class="nav-text">go get: add dependencies to current module and install them</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-install-compile-and-install-packages-and-dependencies"><span class="nav-number">2.10.</span> <span class="nav-text">go install: compile and install packages and dependencies</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-list-list-packages-or-modules"><span class="nav-number">2.11.</span> <span class="nav-text">go list: list packages or modules</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-mod-%E6%A8%A1%E5%9D%97%E7%BB%B4%E6%8A%A4%E7%9B%B8%E5%85%B3"><span class="nav-number">2.12.</span> <span class="nav-text">go mod: 模块维护相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-download-%E5%B0%86%E6%A8%A1%E5%9D%97%E4%B8%8B%E8%BD%BD%E5%88%B0%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98%E4%B8%AD"><span class="nav-number">2.12.1.</span> <span class="nav-text">go mod download: 将模块下载到本地缓存中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-edit-%E7%BC%96%E8%BE%91go-mod"><span class="nav-number">2.12.2.</span> <span class="nav-text">go mod edit: 编辑go.mod</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-graph-%E6%89%93%E5%8D%B0%E5%87%BA%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96%E5%9B%BE"><span class="nav-number">2.12.3.</span> <span class="nav-text">go mod graph: 打印出模块依赖图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-init-%E5%9C%A8%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B0%E6%A8%A1%E5%9D%97"><span class="nav-number">2.12.4.</span> <span class="nav-text">go mod init: 在当前目录中初始化新模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-tidy-add-missing-and-remove-unused-modules"><span class="nav-number">2.12.5.</span> <span class="nav-text">go mod tidy: add missing and remove unused modules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-vendor-%E6%8B%B7%E8%B4%9D%E4%BE%9D%E8%B5%96%E5%88%B0vendor%E7%9B%AE%E5%BD%95%E4%B8%AD"><span class="nav-number">2.12.6.</span> <span class="nav-text">go mod vendor: 拷贝依赖到vendor目录中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-verify-%E6%A0%A1%E9%AA%8C%E4%BE%9D%E8%B5%96%E7%A1%AE%E5%AE%9E%E5%90%AB%E6%9C%89%E6%9C%9F%E6%9C%9B%E7%9A%84%E5%86%85%E5%AE%B9"><span class="nav-number">2.12.7.</span> <span class="nav-text">go mod verify: 校验依赖确实含有期望的内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-why-%E8%A7%A3%E9%87%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%80%E4%B8%AA%E5%8C%85%E6%88%96%E8%80%85%E6%A8%A1%E5%9D%97%E8%A2%AB%E9%9C%80%E8%A6%81"><span class="nav-number">2.12.8.</span> <span class="nav-text">go mod why: 解释为什么一个包或者模块被需要</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-run-%E7%BC%96%E8%AF%91%E5%B9%B6%E8%BF%90%E8%A1%8Cgo%E7%A8%8B%E5%BA%8F"><span class="nav-number">2.13.</span> <span class="nav-text">go run: 编译并运行go程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-test-%E8%BF%90%E8%A1%8C%E5%8C%85%E7%9A%84%E6%B5%8B%E8%AF%95"><span class="nav-number">2.14.</span> <span class="nav-text">go test: 运行包的测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-tool-run-specified-go-tool"><span class="nav-number">2.15.</span> <span class="nav-text">go tool: run specified go tool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-version-print-go-version"><span class="nav-number">2.16.</span> <span class="nav-text">go version: print go version</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go-vet-%E6%A3%80%E6%9F%A5%E6%BD%9C%E5%9C%A8%E7%9A%84%E7%A8%8B%E5%BA%8F%E9%94%99%E8%AF%AF"><span class="nav-number">2.17.</span> <span class="nav-text">go vet: 检查潜在的程序错误</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kaiktang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">kaiktang</p>
  <div class="site-description" itemprop="description">学而后知不足</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:tomkklalala@qq.com" title="E-Mail → mailto:tomkklalala@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kaiktang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://kaiktang.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://kaiktang.github.io/2022/02/06/Go%E5%B7%A5%E5%85%B7%E9%93%BE%E7%B3%BB%E5%88%97%EF%BC%9Ago%E5%91%BD%E4%BB%A4/";
    this.page.identifier = "2022/02/06/Go工具链系列：go命令/";
    this.page.title = "Go工具链系列：go命令";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://kaiktang.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
